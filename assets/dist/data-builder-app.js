var Us=Object.defineProperty;var Bs=(s,a,t)=>a in s?Us(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t;var hs=(s,a,t)=>Bs(s,typeof a!="symbol"?a+"":a,t);import{t as Ds,k as he,m as He,n as Ws,j as e,o as qs,p as Js,q as Ks,u as ps,$ as Hs,v as Vs,r as F,c as xs,w as gs,x as Ae,y as Xs,f as Ys,R as W,b as G,I as l,d as M,e as U,i as ae,s as Ie,l as ze,z as Ue,g as Rs,A as pe,h as Zs}from"./iconify.js";import{a as Qs,d as et,t as _e,c as Qe,H as st}from"./middleware.js";import{u as tt,p as rt,i as cs,e as J,a as Fs,c as Os,b as fs,d as at,T as it}from"./productData.js";import{u as ge,c as H,m as ve,a as be,b as we,d as Ne,e as ye}from"./index.js";import{c as Y,p as ls,a as Ve}from"./chunk-XVMALT6H.js";import{d as Re,a as Fe,b as Oe,m as ie}from"./chunk-XHRYXXZA.js";import{t as ke,a as V}from"./chunk-ML27DD5T.js";import"./features-animation.js";var nt=Ds({slots:{base:["flex","relative","justify-center","items-center","box-border","overflow-hidden","align-middle","text-white","z-0",...Ws],img:["flex","object-cover","w-full","h-full","transition-opacity","!duration-500","opacity-0","data-[loaded=true]:opacity-100"],fallback:[...He,"flex","items-center","justify-center"],name:[...He,"font-normal","text-center","text-inherit"],icon:[...He,"flex","items-center","justify-center","text-inherit","w-full","h-full"]},variants:{size:{sm:{base:"w-8 h-8 text-tiny"},md:{base:"w-10 h-10 text-tiny"},lg:{base:"w-14 h-14 text-small"}},color:{default:{base:he.solid.default},primary:{base:he.solid.primary},secondary:{base:he.solid.secondary},success:{base:he.solid.success},warning:{base:he.solid.warning},danger:{base:he.solid.danger}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"},full:{base:"rounded-full"}},isBordered:{true:{base:"ring-2 ring-offset-2 ring-offset-background dark:ring-offset-background-dark"}},isDisabled:{true:{base:"opacity-disabled"}},isInGroup:{true:{base:["-ms-2 data-[hover=true]:-translate-x-3 rtl:data-[hover=true]:translate-x-3 transition-transform","data-[focus-visible=true]:-translate-x-3 rtl:data-[focus-visible=true]:translate-x-3"]}},isInGridGroup:{true:{base:"m-0 data-[hover=true]:translate-x-0"}},disableAnimation:{true:{base:"transition-none",img:"transition-none"},false:{}}},defaultVariants:{size:"md",color:"default",radius:"full"},compoundVariants:[{color:"default",isBordered:!0,class:{base:"ring-default"}},{color:"primary",isBordered:!0,class:{base:"ring-primary"}},{color:"secondary",isBordered:!0,class:{base:"ring-secondary"}},{color:"success",isBordered:!0,class:{base:"ring-success"}},{color:"warning",isBordered:!0,class:{base:"ring-warning"}},{color:"danger",isBordered:!0,class:{base:"ring-danger"}}]});Ds({slots:{base:"flex items-center justify-center h-auto w-max",count:"hover:-translate-x-0"},variants:{isGrid:{true:"inline-grid grid-cols-4 gap-3"}}});var ct=()=>e.jsxs("svg",{"aria-hidden":"true",fill:"none",height:"80%",role:"presentation",viewBox:"0 0 24 24",width:"80%",children:[e.jsx("path",{d:"M12 2C9.38 2 7.25 4.13 7.25 6.75C7.25 9.32 9.26 11.4 11.88 11.49C11.96 11.48 12.04 11.48 12.1 11.49C12.12 11.49 12.13 11.49 12.15 11.49C12.16 11.49 12.16 11.49 12.17 11.49C14.73 11.4 16.74 9.32 16.75 6.75C16.75 4.13 14.62 2 12 2Z",fill:"currentColor"}),e.jsx("path",{d:"M17.0809 14.1489C14.2909 12.2889 9.74094 12.2889 6.93094 14.1489C5.66094 14.9989 4.96094 16.1489 4.96094 17.3789C4.96094 18.6089 5.66094 19.7489 6.92094 20.5889C8.32094 21.5289 10.1609 21.9989 12.0009 21.9989C13.8409 21.9989 15.6809 21.5289 17.0809 20.5889C18.3409 19.7389 19.0409 18.5989 19.0409 17.3589C19.0309 16.1289 18.3409 14.9889 17.0809 14.1489Z",fill:"currentColor"})]}),[Jt,lt]=qs({name:"AvatarGroupContext",strict:!1});function ot(s={}){var a,t,r,i,n,c,o,g;const m=Js(),p=lt(),u=!!p,{as:x,ref:d,src:b,name:D,icon:S,classNames:O,fallback:k,alt:T=D||"avatar",imgRef:R,color:A=(a=p==null?void 0:p.color)!=null?a:"default",radius:f=(t=p==null?void 0:p.radius)!=null?t:"full",size:P=(r=p==null?void 0:p.size)!=null?r:"md",isBordered:w=(i=p==null?void 0:p.isBordered)!=null?i:!1,isDisabled:I=(n=p==null?void 0:p.isDisabled)!=null?n:!1,isFocusable:h=!1,getInitials:N=Ks,ignoreFallback:E=!1,showFallback:z=!1,ImgComponent:v="img",imgProps:C,className:j,onError:y,disableAnimation:_,...q}=s,Z=x||"span",B=ps(d),L=ps(R),{isFocusVisible:$,isFocused:K,focusProps:X}=Hs(),{isHovered:ce,hoverProps:ee}=Vs({isDisabled:I}),le=(c=_??(m==null?void 0:m.disableAnimation))!=null?c:!1,Pe=(g=typeof v=="object"&&((o=v==null?void 0:v.displayName)==null?void 0:o.includes("HeroUI")))!=null?g:!1,Ee=tt({src:b,onError:y,ignoreFallback:E,shouldBypassImageLoad:x!==void 0||v!=="img"&&!Pe})==="loaded",us=!Pe,Ls=(!b||!Ee)&&z,Ce=F.useMemo(()=>{var oe;return nt({color:A,radius:f,size:P,isBordered:w,isDisabled:I,isInGroup:u,disableAnimation:le,isInGridGroup:(oe=p==null?void 0:p.isGrid)!=null?oe:!1})},[A,f,P,w,I,le,u,p==null?void 0:p.isGrid]),ms=xs(O==null?void 0:O.base,j),Ke=F.useMemo(()=>h||x==="button",[h,x]),Ms=F.useCallback((oe={})=>({ref:B,tabIndex:Ke?0:-1,"data-hover":Ae(ce),"data-focus":Ae(K),"data-focus-visible":Ae($),className:Ce.base({class:xs(ms,oe==null?void 0:oe.className)}),...gs(q,ee,Ke?X:{})}),[Ke,Ce,ms,X,q]),$s=F.useCallback((oe={})=>({ref:L,src:b,"data-loaded":Ae(Ee),className:Ce.img({class:O==null?void 0:O.img}),...gs(C,oe,Xs({disableAnimation:le},{enabled:us}))}),[Ce,Ee,C,le,b,L,us]);return{Component:Z,ImgComponent:v,src:b,alt:T,icon:S,name:D,imgRef:L,slots:Ce,classNames:O,fallback:k,isImgLoaded:Ee,showFallback:Ls,ignoreFallback:E,getInitials:N,getAvatarProps:Ms,getImageProps:$s}}var ks=Ys((s,a)=>{const{Component:t,ImgComponent:r,src:i,icon:n=e.jsx(ct,{}),alt:c,classNames:o,slots:g,name:m,showFallback:p,fallback:u,getInitials:x,getAvatarProps:d,getImageProps:b}=ot({...s,ref:a}),D=F.useMemo(()=>!p&&i?null:u?e.jsx("div",{"aria-label":c,className:g.fallback({class:o==null?void 0:o.fallback}),role:"img",children:u}):m?e.jsx("span",{"aria-label":c,className:g.name({class:o==null?void 0:o.name}),role:"img",children:x(m)}):e.jsx("span",{"aria-label":c,className:g.icon({class:o==null?void 0:o.icon}),role:"img",children:n}),[p,i,u,m,o]);return e.jsxs(t,{...d(),children:[i&&e.jsx(r,{...b(),alt:c}),D]})});ks.displayName="HeroUI.Avatar";var xe=ks,Ts=Symbol.for("immer-nothing"),js=Symbol.for("immer-draftable"),Q=Symbol.for("immer-state");function te(s,...a){throw new Error(`[Immer] minified error nr: ${s}. Full error at: https://bit.ly/3cXEKWf`)}var fe=Object.getPrototypeOf;function je(s){return!!s&&!!s[Q]}function ue(s){var a;return s?Es(s)||Array.isArray(s)||!!s[js]||!!((a=s.constructor)!=null&&a[js])||Te(s)||We(s):!1}var dt=Object.prototype.constructor.toString();function Es(s){if(!s||typeof s!="object")return!1;const a=fe(s);if(a===null)return!0;const t=Object.hasOwnProperty.call(a,"constructor")&&a.constructor;return t===Object?!0:typeof t=="function"&&Function.toString.call(t)===dt}function Le(s,a){Be(s)===0?Reflect.ownKeys(s).forEach(t=>{a(t,s[t],s)}):s.forEach((t,r)=>a(r,t,s))}function Be(s){const a=s[Q];return a?a.type_:Array.isArray(s)?1:Te(s)?2:We(s)?3:0}function es(s,a){return Be(s)===2?s.has(a):Object.prototype.hasOwnProperty.call(s,a)}function As(s,a,t){const r=Be(s);r===2?s.set(a,t):r===3?s.add(t):s[a]=t}function ut(s,a){return s===a?s!==0||1/s===1/a:s!==s&&a!==a}function Te(s){return s instanceof Map}function We(s){return s instanceof Set}function de(s){return s.copy_||s.base_}function ss(s,a){if(Te(s))return new Map(s);if(We(s))return new Set(s);if(Array.isArray(s))return Array.prototype.slice.call(s);const t=Es(s);if(a===!0||a==="class_only"&&!t){const r=Object.getOwnPropertyDescriptors(s);delete r[Q];let i=Reflect.ownKeys(r);for(let n=0;n<i.length;n++){const c=i[n],o=r[c];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(r[c]={configurable:!0,writable:!0,enumerable:o.enumerable,value:s[c]})}return Object.create(fe(s),r)}else{const r=fe(s);if(r!==null&&t)return{...s};const i=Object.create(r);return Object.assign(i,s)}}function os(s,a=!1){return qe(s)||je(s)||!ue(s)||(Be(s)>1&&Object.defineProperties(s,{set:{value:Ge},add:{value:Ge},clear:{value:Ge},delete:{value:Ge}}),Object.freeze(s),a&&Object.values(s).forEach(t=>os(t,!0))),s}function Ge(){te(2)}function qe(s){return Object.isFrozen(s)}var mt={};function me(s){const a=mt[s];return a||te(0,s),a}var Se;function Gs(){return Se}function ht(s,a){return{drafts_:[],parent_:s,immer_:a,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function vs(s,a){a&&(me("Patches"),s.patches_=[],s.inversePatches_=[],s.patchListener_=a)}function ts(s){rs(s),s.drafts_.forEach(pt),s.drafts_=null}function rs(s){s===Se&&(Se=s.parent_)}function bs(s){return Se=ht(Se,s)}function pt(s){const a=s[Q];a.type_===0||a.type_===1?a.revoke_():a.revoked_=!0}function ws(s,a){a.unfinalizedDrafts_=a.drafts_.length;const t=a.drafts_[0];return s!==void 0&&s!==t?(t[Q].modified_&&(ts(a),te(4)),ue(s)&&(s=Me(a,s),a.parent_||$e(a,s)),a.patches_&&me("Patches").generateReplacementPatches_(t[Q].base_,s,a.patches_,a.inversePatches_)):s=Me(a,t,[]),ts(a),a.patches_&&a.patchListener_(a.patches_,a.inversePatches_),s!==Ts?s:void 0}function Me(s,a,t){if(qe(a))return a;const r=a[Q];if(!r)return Le(a,(i,n)=>Ns(s,r,a,i,n,t)),a;if(r.scope_!==s)return a;if(!r.modified_)return $e(s,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const i=r.copy_;let n=i,c=!1;r.type_===3&&(n=new Set(i),i.clear(),c=!0),Le(n,(o,g)=>Ns(s,r,i,o,g,t,c)),$e(s,i,!1),t&&s.patches_&&me("Patches").generatePatches_(r,t,s.patches_,s.inversePatches_)}return r.copy_}function Ns(s,a,t,r,i,n,c){if(je(i)){const o=n&&a&&a.type_!==3&&!es(a.assigned_,r)?n.concat(r):void 0,g=Me(s,i,o);if(As(t,r,g),je(g))s.canAutoFreeze_=!1;else return}else c&&t.add(i);if(ue(i)&&!qe(i)){if(!s.immer_.autoFreeze_&&s.unfinalizedDrafts_<1)return;Me(s,i),(!a||!a.scope_.parent_)&&typeof r!="symbol"&&(Te(t)?t.has(r):Object.prototype.propertyIsEnumerable.call(t,r))&&$e(s,i)}}function $e(s,a,t=!1){!s.parent_&&s.immer_.autoFreeze_&&s.canAutoFreeze_&&os(a,t)}function xt(s,a){const t=Array.isArray(s),r={type_:t?1:0,scope_:a?a.scope_:Gs(),modified_:!1,finalized_:!1,assigned_:{},parent_:a,base_:s,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,n=ds;t&&(i=[r],n=De);const{revoke:c,proxy:o}=Proxy.revocable(i,n);return r.draft_=o,r.revoke_=c,o}var ds={get(s,a){if(a===Q)return s;const t=de(s);if(!es(t,a))return gt(s,t,a);const r=t[a];return s.finalized_||!ue(r)?r:r===Xe(s.base_,a)?(Ye(s),s.copy_[a]=is(r,s)):r},has(s,a){return a in de(s)},ownKeys(s){return Reflect.ownKeys(de(s))},set(s,a,t){const r=Is(de(s),a);if(r!=null&&r.set)return r.set.call(s.draft_,t),!0;if(!s.modified_){const i=Xe(de(s),a),n=i==null?void 0:i[Q];if(n&&n.base_===t)return s.copy_[a]=t,s.assigned_[a]=!1,!0;if(ut(t,i)&&(t!==void 0||es(s.base_,a)))return!0;Ye(s),as(s)}return s.copy_[a]===t&&(t!==void 0||a in s.copy_)||Number.isNaN(t)&&Number.isNaN(s.copy_[a])||(s.copy_[a]=t,s.assigned_[a]=!0),!0},deleteProperty(s,a){return Xe(s.base_,a)!==void 0||a in s.base_?(s.assigned_[a]=!1,Ye(s),as(s)):delete s.assigned_[a],s.copy_&&delete s.copy_[a],!0},getOwnPropertyDescriptor(s,a){const t=de(s),r=Reflect.getOwnPropertyDescriptor(t,a);return r&&{writable:!0,configurable:s.type_!==1||a!=="length",enumerable:r.enumerable,value:t[a]}},defineProperty(){te(11)},getPrototypeOf(s){return fe(s.base_)},setPrototypeOf(){te(12)}},De={};Le(ds,(s,a)=>{De[s]=function(){return arguments[0]=arguments[0][0],a.apply(this,arguments)}});De.deleteProperty=function(s,a){return De.set.call(this,s,a,void 0)};De.set=function(s,a,t){return ds.set.call(this,s[0],a,t,s[0])};function Xe(s,a){const t=s[Q];return(t?de(t):s)[a]}function gt(s,a,t){var i;const r=Is(a,t);return r?"value"in r?r.value:(i=r.get)==null?void 0:i.call(s.draft_):void 0}function Is(s,a){if(!(a in s))return;let t=fe(s);for(;t;){const r=Object.getOwnPropertyDescriptor(t,a);if(r)return r;t=fe(t)}}function as(s){s.modified_||(s.modified_=!0,s.parent_&&as(s.parent_))}function Ye(s){s.copy_||(s.copy_=ss(s.base_,s.scope_.immer_.useStrictShallowCopy_))}var ft=class{constructor(s){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(a,t,r)=>{if(typeof a=="function"&&typeof t!="function"){const n=t;t=a;const c=this;return function(g=n,...m){return c.produce(g,p=>t.call(this,p,...m))}}typeof t!="function"&&te(6),r!==void 0&&typeof r!="function"&&te(7);let i;if(ue(a)){const n=bs(this),c=is(a,void 0);let o=!0;try{i=t(c),o=!1}finally{o?ts(n):rs(n)}return vs(n,r),ws(i,n)}else if(!a||typeof a!="object"){if(i=t(a),i===void 0&&(i=a),i===Ts&&(i=void 0),this.autoFreeze_&&os(i,!0),r){const n=[],c=[];me("Patches").generateReplacementPatches_(a,i,n,c),r(n,c)}return i}else te(1,a)},this.produceWithPatches=(a,t)=>{if(typeof a=="function")return(c,...o)=>this.produceWithPatches(c,g=>a(g,...o));let r,i;return[this.produce(a,t,(c,o)=>{r=c,i=o}),r,i]},typeof(s==null?void 0:s.autoFreeze)=="boolean"&&this.setAutoFreeze(s.autoFreeze),typeof(s==null?void 0:s.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(s.useStrictShallowCopy)}createDraft(s){ue(s)||te(8),je(s)&&(s=jt(s));const a=bs(this),t=is(s,void 0);return t[Q].isManual_=!0,rs(a),t}finishDraft(s,a){const t=s&&s[Q];(!t||!t.isManual_)&&te(9);const{scope_:r}=t;return vs(r,a),ws(void 0,r)}setAutoFreeze(s){this.autoFreeze_=s}setUseStrictShallowCopy(s){this.useStrictShallowCopy_=s}applyPatches(s,a){let t;for(t=a.length-1;t>=0;t--){const i=a[t];if(i.path.length===0&&i.op==="replace"){s=i.value;break}}t>-1&&(a=a.slice(t+1));const r=me("Patches").applyPatches_;return je(s)?r(s,a):this.produce(s,i=>r(i,a))}};function is(s,a){const t=Te(s)?me("MapSet").proxyMap_(s,a):We(s)?me("MapSet").proxySet_(s,a):xt(s,a);return(a?a.scope_:Gs()).drafts_.push(t),t}function jt(s){return je(s)||te(10,s),zs(s)}function zs(s){if(!ue(s)||qe(s))return s;const a=s[Q];let t;if(a){if(!a.modified_)return a.base_;a.finalized_=!0,t=ss(s,a.scope_.immer_.useStrictShallowCopy_)}else t=ss(s,!0);return Le(t,(r,i)=>{As(t,r,zs(i))}),a&&(a.finalized_=!1),t}var vt=new ft,bt=vt.produce;const wt=s=>(a,t,r)=>(r.setState=(i,n,...c)=>{const o=typeof i=="function"?bt(i):i;return a(o,n,...c)},s(r.setState,t,r)),Nt=wt,se=s=>s.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),ys=s=>({Shelter:"lucide:home",Toilet:"lucide:bath",Bridge:"lucide:route",Access:"lucide:wheelchair",Seating:"lucide:armchair",Lighting:"lucide:lamp"})[s]||"lucide:box",Ps=s=>({Shelter:"Outdoor structures for shade and protection",Toilet:"Public and portable sanitation facilities",Bridge:"Pedestrian and light vehicle crossings",Access:"Ramps, stairs, and accessibility solutions",Seating:"Benches and outdoor furniture options",Lighting:"Outdoor and pathway lighting solutions"})[s]||"Product category",Cs=s=>({Peninsula:"Modern shelters with excellent weather protection for parks and urban settings",Whyalla:"Robust shelters designed for coastal and high-wind environments",Coastal:"Corrosion-resistant designs perfect for beachfront and marine locations",Urban:"Contemporary designs that blend with modern city landscapes",Heritage:"Traditional designs that complement historic and cultural settings",EcoSan:"Environmentally friendly composting toilet solutions with minimal water usage",Standard:"Reliable and cost-effective public toilet facilities",Accessible:"Fully compliant accessible toilet facilities with enhanced features",Premium:"High-end toilet facilities with superior finishes and amenities",Compact:"Space-saving designs for areas with limited footprint","Small Span":"Compact bridges for garden paths and small water crossings","Large Span":"Extended bridges for wider crossings and heavier loads",Pedestrian:"Dedicated walkways designed for high foot traffic areas",Decorative:"Ornamental bridges that serve as landscape features","Heavy Duty":"Reinforced bridges capable of supporting maintenance vehicles"})[s]||`${s} product range`,_s=s=>{const a={Peninsula:["Modern","Weather-resistant","Versatile"],Whyalla:["Robust","Wind-resistant","Durable"],Coastal:["Corrosion-resistant","Salt-proof","UV-stable"],Urban:["Contemporary","Modular","Space-efficient"],Heritage:["Traditional","Ornate","Classic"],EcoSan:["Eco-friendly","Low-water","Composting"],Standard:["Cost-effective","Reliable","Low-maintenance"],Accessible:["ADA Compliant","Spacious","Universal"],Premium:["High-end","Enhanced features","Superior finishes"],Compact:["Space-saving","Efficient","Urban-friendly"],"Small Span":["Compact","Decorative","Easy-install"],"Large Span":["Extended","Reinforced","Heavy-load"],Pedestrian:["High-traffic","Safety-focused","Accessible"],Decorative:["Ornamental","Artistic","Feature piece"],"Heavy Duty":["Vehicle-rated","Industrial","Maximum strength"],default:["Quality","Durable","Customizable"]};return a[s]||a.default},Ze={id:1,stepperForm:{steps:[{step:1,title:"Select Product Group",categories:[]},{step:2,title:"Select Product Range",ranges:{}},{step:3,title:"Select Individual Product",products:{}},{step:4,title:"View Product Content",productDetails:{}},{step:5,title:"Configure Options",options:{}},{step:6,title:"Contact Information",fields:[{name:"fullName",label:"Full Name",type:"text",required:!0},{name:"email",label:"Email Address",type:"email",required:!0},{name:"phone",label:"Phone Number",type:"tel",required:!1},{name:"company",label:"Company/Organization",type:"text",required:!1},{name:"message",label:"Additional Notes",type:"textarea",required:!1}]}]}},ne=Qs()(et(Nt((s,a)=>({productData:Ze,productGroups:[],productRanges:[],products:[],relationships:{groupToRanges:{},rangeToProducts:{}},isDirty:!1,isSaving:!1,isLoading:!1,lastSaved:null,error:null,initializeFromWindowData:()=>{const t=window.urbanaAdmin;if(!t){console.warn("No urbanaAdmin window data found");return}t.stepperFormData&&(console.log("Loading stepper form data:",t.stepperFormData),s(r=>{r.productData=t.stepperFormData})),t.stepperDataBuilder&&typeof t.stepperDataBuilder=="object"&&t.stepperDataBuilder.productGroups&&t.stepperDataBuilder.productGroups.length>0?(console.log("Loading existing data builder data:",t.stepperDataBuilder),s(r=>{r.productGroups=t.stepperDataBuilder.productGroups||[],r.productRanges=t.stepperDataBuilder.productRanges||[],r.products=t.stepperDataBuilder.products||[],r.relationships=t.stepperDataBuilder.relationships||{groupToRanges:{},rangeToProducts:{}},t.stepperDataBuilder.lastSaved&&(r.lastSaved=new Date(t.stepperDataBuilder.lastSaved)),r.isDirty=!1})):(console.log("No existing data builder data found, extracting from stepper form data"),t.stepperFormData&&t.stepperFormData.stepperForm?a().initializeFromProductData(t.stepperFormData):(a().initializeFromProductData(rt),console.warn("No stepper form data found in window.urbanaAdmin")))},loadData:async t=>{var r;if(!t){a().initializeFromWindowData();return}s(i=>{i.isLoading=!0,i.error=null});try{const i=await fetch(`/wp-json/urbana/v1/data-builder/${t}`,{method:"GET",headers:{"X-WP-Nonce":((r=window.urbanaAdmin)==null?void 0:r.nonce)||""}});if(!i.ok)throw new Error(`Failed to load data: ${i.status} ${i.statusText}`);const n=await i.json();n.stepper_form_data&&s(c=>{c.productData=n.stepper_form_data}),n.stepper_data_builder&&typeof n.stepper_data_builder=="object"&&n.stepper_data_builder.productGroups&&n.stepper_data_builder.productGroups.length>0?(console.log("Loading existing API data builder data:",n.stepper_data_builder),s(c=>{c.productGroups=n.stepper_data_builder.productGroups||[],c.productRanges=n.stepper_data_builder.productRanges||[],c.products=n.stepper_data_builder.products||[],c.relationships=n.stepper_data_builder.relationships||{groupToRanges:{},rangeToProducts:{}},n.stepper_data_builder.lastSaved&&(c.lastSaved=new Date(n.stepper_data_builder.lastSaved))})):(console.log("No existing API data builder data found, extracting from stepper form data"),n.stepper_form_data&&a().initializeFromProductData(n.stepper_form_data))}catch(i){const n=i instanceof Error?i.message:"Unknown error occurred";throw console.error("Error loading data:",n),s(c=>{c.error=n}),i}finally{s(i=>{i.isLoading=!1})}},getRangesForGroup:t=>{const{productRanges:r,relationships:i}=a(),n=i.groupToRanges[t]||[];return r.filter(c=>n.includes(c.id))},getProductsForRange:t=>{const{products:r,relationships:i}=a(),n=i.rangeToProducts[t]||[];return r.filter(c=>n.includes(c.id))},getProductById:t=>{const{products:r}=a();return r.find(i=>i.id===t)},getGroupById:t=>{const{productGroups:r}=a();return r.find(i=>i.id===t)},getRangeById:t=>{const{productRanges:r}=a();return r.find(i=>i.id===t)},saveData:async()=>{var t;s(r=>{r.isSaving=!0,r.error=null});try{const r=a().exportData(),{productGroups:i,productRanges:n,products:c,relationships:o}=a(),g=await fetch("/wp-json/urbana/v1/product-data",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((t=window.urbanaAdmin)==null?void 0:t.nonce)||""},body:JSON.stringify({stepper_form_data:r,stepper_data_builder:{productGroups:i,productRanges:n,products:c,relationships:o,lastSaved:new Date().toISOString()}})});if(!g.ok)throw new Error(`Failed to save data: ${g.status} ${g.statusText}`);const m=await g.json();return s(p=>{p.productData=r,p.isDirty=!1,p.lastSaved=new Date}),console.log("Data saved successfully, stepper ID:",m.stepper_id),m.stepper_id}catch(r){const i=r instanceof Error?r.message:"Unknown error occurred";throw console.error("Error saving data:",i),s(n=>{n.error=i}),r}finally{s(r=>{r.isSaving=!1})}},initializeFromProductData:t=>s(r=>{r.productData=t;const i=(t.stepperForm.steps[0].categories||[]).map(m=>({id:se(m),name:m,icon:ys(m),description:Ps(m)}));r.productGroups=i;const n=[];Object.entries(t.stepperForm.steps[1].ranges||{}).forEach(([m,p])=>{p.forEach(u=>{n.push({id:se(u),name:u,image:"",description:Cs(u),tags:_s(u)})})}),r.productRanges=n;const c=[];Object.entries(t.stepperForm.steps[2].products||{}).forEach(([m,p])=>{p.forEach(u=>{var d;const x=(d=t.stepperForm.steps[3].productDetails)==null?void 0:d[u];c.push({id:se(u),code:u,name:(x==null?void 0:x.name)||`${u} Product`,overview:(x==null?void 0:x.overview)||"",description:(x==null?void 0:x.description)||"",specifications:(x==null?void 0:x.specifications)||[],imageGallery:(x==null?void 0:x.imageGallery)||[],files:(x==null?void 0:x.files)||{}})})}),r.products=c;const o={};Object.entries(t.stepperForm.steps[1].ranges||{}).forEach(([m,p])=>{const u=se(m);o[u]=p.map(x=>se(x))});const g={};Object.entries(t.stepperForm.steps[2].products||{}).forEach(([m,p])=>{const u=se(m);g[u]=p.map(x=>se(x))}),r.relationships={groupToRanges:o,rangeToProducts:g}}),updateProductData:t=>s(r=>{r.productData=t,r.isDirty=!0}),exportData:()=>{const{productGroups:t,productRanges:r,products:i,relationships:n,productData:c}=a();return{id:c.id,stepperForm:{steps:[{step:1,title:"Select Product Group",categories:t.map(g=>g.name)},{step:2,title:"Select Product Range",ranges:(()=>{const g={};return Object.entries(n.groupToRanges).forEach(([m,p])=>{const u=t.find(x=>x.id===m);u&&(g[u.name]=p.map(x=>{const d=r.find(b=>b.id===x);return d?d.name:""}).filter(x=>x!==""))}),g})()},{step:3,title:"Select Individual Product",products:(()=>{const g={};return Object.entries(n.rangeToProducts).forEach(([m,p])=>{const u=r.find(x=>x.id===m);u&&(g[u.name]=p.map(x=>{const d=i.find(b=>b.id===x);return d?d.code:""}).filter(x=>x!==""))}),g})()},{step:4,title:"View Product Content",productDetails:(()=>{const g={};return i.forEach(m=>{g[m.code]={name:m.name,overview:m.overview,description:m.description,specifications:m.specifications,imageGallery:m.imageGallery,files:m.files}}),g})()},c.stepperForm.steps[4]||{step:5,title:"Configure Options",options:{}},c.stepperForm.steps[5]||{step:6,title:"Contact Information",fields:Ze.stepperForm.steps[5].fields}]}}},addProductGroup:t=>s(r=>{const i=se(t.name),n={...t,id:i,icon:t.icon||ys(t.name),description:t.description||Ps(t.name)};r.productGroups.some(o=>o.id===i)||(r.productGroups.push(n),r.relationships.groupToRanges[i]=[],r.isDirty=!0)}),updateProductGroup:(t,r)=>s(i=>{const n=i.productGroups.findIndex(c=>c.id===t);n!==-1&&(i.productGroups[n]={...i.productGroups[n],...r},i.isDirty=!0)}),removeProductGroup:t=>s(r=>{r.productGroups=r.productGroups.filter(n=>n.id!==t),(r.relationships.groupToRanges[t]||[]).forEach(n=>{r.productRanges=r.productRanges.filter(o=>o.id!==n),(r.relationships.rangeToProducts[n]||[]).forEach(o=>{r.products=r.products.filter(g=>g.id!==o)}),delete r.relationships.rangeToProducts[n]}),delete r.relationships.groupToRanges[t],r.isDirty=!0}),addProductRange:t=>s(r=>{const i=se(t.name),n={...t,id:i,description:t.description||Cs(t.name),tags:t.tags||_s(t.name)};r.productRanges.some(o=>o.id===i)||(r.productRanges.push(n),r.relationships.rangeToProducts[i]=[],r.isDirty=!0)}),updateProductRange:(t,r)=>s(i=>{const n=i.productRanges.findIndex(c=>c.id===t);n!==-1&&(i.productRanges[n]={...i.productRanges[n],...r},i.isDirty=!0)}),removeProductRange:t=>s(r=>{r.productRanges=r.productRanges.filter(n=>n.id!==t),(r.relationships.rangeToProducts[t]||[]).forEach(n=>{r.products=r.products.filter(c=>c.id!==n)}),Object.keys(r.relationships.groupToRanges).forEach(n=>{r.relationships.groupToRanges[n]=r.relationships.groupToRanges[n].filter(c=>c!==t)}),delete r.relationships.rangeToProducts[t],r.isDirty=!0}),addProduct:t=>s(r=>{const i=se(t.code||t.name),n={...t,id:i,code:t.code||se(t.name)};r.products.some(o=>o.id===i)||(r.products.push(n),r.isDirty=!0)}),updateProduct:(t,r)=>s(i=>{const n=i.products.findIndex(c=>c.id===t);n!==-1&&(i.products[n]={...i.products[n],...r},i.isDirty=!0)}),removeProduct:t=>s(r=>{r.products=r.products.filter(i=>i.id!==t),Object.keys(r.relationships.rangeToProducts).forEach(i=>{r.relationships.rangeToProducts[i]=r.relationships.rangeToProducts[i].filter(n=>n!==t)}),r.isDirty=!0}),linkRangeToGroup:(t,r)=>s(i=>{i.relationships.groupToRanges[t]||(i.relationships.groupToRanges[t]=[]),i.relationships.groupToRanges[t].includes(r)||(i.relationships.groupToRanges[t].push(r),i.isDirty=!0)}),unlinkRangeFromGroup:(t,r)=>s(i=>{i.relationships.groupToRanges[t]&&(i.relationships.groupToRanges[t]=i.relationships.groupToRanges[t].filter(n=>n!==r),i.isDirty=!0)}),linkProductToRange:(t,r)=>s(i=>{i.relationships.rangeToProducts[t]||(i.relationships.rangeToProducts[t]=[]),i.relationships.rangeToProducts[t].includes(r)||(i.relationships.rangeToProducts[t].push(r),i.isDirty=!0)}),unlinkProductFromRange:(t,r)=>s(i=>{i.relationships.rangeToProducts[t]&&(i.relationships.rangeToProducts[t]=i.relationships.rangeToProducts[t].filter(n=>n!==r),i.isDirty=!0)}),updateRelationships:t=>s(r=>{r.relationships=t,r.isDirty=!0}),updateOptions:t=>s(r=>{r.productData.stepperForm.steps[4]&&(r.productData.stepperForm.steps[4].options=t,r.isDirty=!0)}),updateContactFields:t=>s(r=>{r.productData.stepperForm.steps[5]&&(r.productData.stepperForm.steps[5].fields=t,r.isDirty=!0)}),resetData:()=>s(t=>{t.productData=Ze,t.productGroups=[],t.productRanges=[],t.products=[],t.relationships={groupToRanges:{},rangeToProducts:{}},t.isDirty=!1,t.lastSaved=null,t.error=null}),importData:t=>s(r=>{r.isDirty=!0,r.lastSaved=null,r.error=null,a().initializeFromProductData(t)}),setError:t=>s(r=>{r.error=t}),clearError:()=>s(t=>{t.error=null})})),{name:"urbana-data-builder"})),yt=({selectedIcon:s,onIconSelect:a})=>{const t=["lucide:box","lucide:home","lucide:bath","lucide:route","lucide:wheelchair","lucide:armchair","lucide:lamp","lucide:tree","lucide:building","lucide:car","lucide:tools","lucide:shield"];return e.jsx("div",{className:"grid grid-cols-6 gap-2",children:t.map(r=>e.jsx(G,{isIconOnly:!0,variant:s===r?"solid":"bordered",color:s===r?"primary":"default",onPress:()=>a(r),className:"h-12 w-12",children:e.jsx(l,{icon:r,width:20})},r))})},Pt=()=>{const{productGroups:s,addProductGroup:a,updateProductGroup:t,removeProductGroup:r,getRangesForGroup:i}=ne(),{isOpen:n,onOpen:c,onOpenChange:o,onClose:g}=ge(),[m,p]=W.useState(null),[u,x]=W.useState({name:"",icon:"lucide:box",description:""}),[d,b]=W.useState({}),D=()=>{p(null),x({name:"",icon:"lucide:box",description:""}),b({}),c()},S=f=>{p(f),x({name:f.name,icon:f.icon,description:f.description}),b({}),c()},O=f=>{const P=i(f).length,w=P>0?`Are you sure you want to delete this product group? This will also remove ${P} associated range(s) and their products.`:"Are you sure you want to delete this product group?";confirm(w)&&r(f)},k=(f,P)=>{x(w=>({...w,[f]:P})),d[f]&&b(w=>({...w,[f]:""}))},T=f=>{x(P=>({...P,icon:f}))},R=()=>{const f={};return u.name.trim()||(f.name="Name is required"),s.some(w=>w.name.toLowerCase()===u.name.toLowerCase()&&(!m||w.id!==m.id))&&(f.name="A product group with this name already exists"),u.description.trim()||(f.description="Description is required"),b(f),Object.keys(f).length===0},A=()=>{R()&&(m?t(m.id,u):a(u),g())};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Product Groups"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Organize your products into logical categories"})]}),e.jsx(G,{color:"primary",onPress:D,startContent:e.jsx(l,{icon:"lucide:plus",width:18}),children:"Add Product Group"})]}),s.length===0?e.jsx(M,{children:e.jsx(U,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(l,{icon:"lucide:layers",width:48,className:"text-foreground-300"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Groups Yet"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create your first product group to get started"})]}),e.jsx(G,{color:"primary",onPress:D,startContent:e.jsx(l,{icon:"lucide:plus",width:18}),children:"Add Product Group"})]})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(f=>{const P=i(f.id).length;return e.jsxs(M,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{icon:e.jsx(l,{icon:f.icon,width:20}),className:"bg-primary-100 text-primary-800",size:"sm"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:f.name}),e.jsxs(H,{size:"sm",variant:"flat",color:"primary",children:[P," range",P!==1?"s":""]})]})]}),e.jsxs(Re,{children:[e.jsx(Fe,{children:e.jsx(G,{isIconOnly:!0,variant:"light",size:"sm",children:e.jsx(l,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(Oe,{"aria-label":"Group Actions",children:[e.jsx(ie,{startContent:e.jsx(l,{icon:"lucide:edit",width:16}),onPress:()=>S(f),children:"Edit"},"edit"),e.jsx(ie,{className:"text-danger",color:"danger",startContent:e.jsx(l,{icon:"lucide:trash",width:16}),onPress:()=>O(f.id),children:"Delete"},"delete")]})]})]})}),e.jsx(U,{className:"pt-0",children:e.jsx("p",{className:"text-sm text-foreground-600",children:f.description})})]},f.id)})}),e.jsx(ve,{isOpen:n,onOpenChange:o,size:"lg",className:"urbana-modal",children:e.jsx(be,{children:f=>e.jsxs(e.Fragment,{children:[e.jsx(we,{children:m?"Edit Product Group":"Add Product Group"}),e.jsx(Ne,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ae,{label:"Name",placeholder:"Enter group name",value:u.name,onChange:P=>k("name",P.target.value),errorMessage:d.name,isInvalid:!!d.name,isRequired:!0,classNames:{input:"urbana-input"}}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground-700 mb-2 block",children:"Icon"}),e.jsx(yt,{selectedIcon:u.icon,onIconSelect:T})]}),e.jsx(_e,{label:"Description",placeholder:"Enter group description",value:u.description,onChange:P=>k("description",P.target.value),errorMessage:d.description,isInvalid:!!d.description,isRequired:!0,rows:3,classNames:{input:"urbana-input"}})]})}),e.jsxs(ye,{children:[e.jsx(G,{variant:"light",onPress:f,children:"Cancel"}),e.jsxs(G,{color:"primary",onPress:A,children:[m?"Update":"Add"," Group"]})]})]})})})]})},Ct=({tags:s,onTagsChange:a})=>{const[t,r]=W.useState(""),i=c=>{if(c.key==="Enter"&&t.trim()){c.preventDefault();const o=t.trim();s.includes(o)||a([...s,o]),r("")}},n=c=>{a(s.filter(o=>o!==c))};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{placeholder:"Type a tag and press Enter",value:t,onChange:c=>r(c.target.value),onKeyDown:i,classNames:{input:"urbana-input"}}),s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(c=>e.jsx(H,{onClose:()=>n(c),variant:"flat",size:"sm",children:c},c))})]})},_t=()=>{const{productRanges:s,productGroups:a,addProductRange:t,updateProductRange:r,removeProductRange:i,getProductsForRange:n,linkRangeToGroup:c,unlinkRangeFromGroup:o,relationships:g}=ne(),{isOpen:m,onOpen:p,onOpenChange:u,onClose:x}=ge(),[d,b]=W.useState(null),[D,S]=W.useState({name:"",image:"",description:"",tags:[]}),[O,k]=W.useState(new Set),[T,R]=W.useState({}),A=()=>{b(null),S({name:"",image:"",description:"",tags:[]}),k(new Set),R({}),p()},f=v=>{b(v),S({name:v.name,image:v.image,description:v.description,tags:[...v.tags]});const C=new Set;Object.entries(g.groupToRanges).forEach(([j,y])=>{y.includes(v.id)&&C.add(j)}),k(C),R({}),p()},P=v=>{const C=n(v).length,j=C>0?`Are you sure you want to delete this product range? This will also remove ${C} associated product(s).`:"Are you sure you want to delete this product range?";confirm(j)&&i(v)},w=(v,C)=>{S(j=>({...j,[v]:C})),T[v]&&R(j=>({...j,[v]:""}))},I=()=>{const v={};return D.name.trim()||(v.name="Name is required"),s.some(j=>j.name.toLowerCase()===D.name.toLowerCase()&&(!d||j.id!==d.id))&&(v.name="A product range with this name already exists"),D.description.trim()||(v.description="Description is required"),O.size===0&&(v.groups="Please select at least one product group"),R(v),Object.keys(v).length===0},h=()=>{if(!I())return;let v;d?(r(d.id,D),v=d.id,Object.keys(g.groupToRanges).forEach(C=>{o(C,d.id)})):(t(D),v=D.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")),O.forEach(C=>{c(C,v)}),x()},N=()=>{const v={},C=[];return s.forEach(j=>{let y=!1;Object.entries(g.groupToRanges).forEach(([_,q])=>{if(q.includes(j.id)){const Z=a.find(B=>B.id===_);Z&&(v[Z.name]||(v[Z.name]=[]),v[Z.name].push(j),y=!0)}}),y||C.push(j)}),{grouped:v,ungrouped:C}},{grouped:E,ungrouped:z}=N();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Product Ranges"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Define specific product lines within each group"})]}),e.jsx(G,{color:"primary",onPress:A,startContent:e.jsx(l,{icon:"lucide:plus",width:18}),isDisabled:a.length===0,children:"Add Product Range"})]}),a.length===0?e.jsx(M,{children:e.jsx(U,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(l,{icon:"lucide:alert-circle",width:48,className:"text-warning-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Groups Available"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"You need to create product groups first before adding ranges"})]})]})})}):s.length===0?e.jsx(M,{children:e.jsx(U,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(l,{icon:"lucide:grid-3x3",width:48,className:"text-foreground-300"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Ranges Yet"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create your first product range to organize your products"})]}),e.jsx(G,{color:"primary",onPress:A,startContent:e.jsx(l,{icon:"lucide:plus",width:18}),children:"Add Product Range"})]})})}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(E).map(([v,C])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:layers",width:18}),v,e.jsxs(H,{size:"sm",variant:"flat",children:[C.length," range",C.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(j=>e.jsx(Ss,{range:j,onEdit:f,onDelete:P},j.id))})]},v)),z.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2 text-warning-600",children:[e.jsx(l,{icon:"lucide:alert-triangle",width:18}),"Ungrouped Ranges",e.jsxs(H,{size:"sm",variant:"flat",color:"warning",children:[z.length," range",z.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:z.map(v=>e.jsx(Ss,{range:v,onEdit:f,onDelete:P},v.id))})]})]}),e.jsx(ve,{isOpen:m,onOpenChange:u,size:"2xl",className:"urbana-modal",children:e.jsx(be,{children:v=>e.jsxs(e.Fragment,{children:[e.jsx(we,{children:d?"Edit Product Range":"Add Product Range"}),e.jsx(Ne,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ae,{label:"Name",placeholder:"Enter range name",value:D.name,onChange:C=>w("name",C.target.value),errorMessage:T.name,isInvalid:!!T.name,isRequired:!0,classNames:{input:"urbana-input"}}),e.jsx(Ie,{label:"Product Groups",placeholder:"Select product groups for this range",selectionMode:"multiple",selectedKeys:O,onSelectionChange:C=>k(C),errorMessage:T.groups,isInvalid:!!T.groups,isRequired:!0,children:a.map(C=>e.jsx(ze,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:C.icon,width:16}),C.name]})},C.id))}),e.jsx(ae,{label:"Image URL",placeholder:"Enter image URL (optional)",value:D.image,onChange:C=>w("image",C.target.value),classNames:{input:"urbana-input"}}),e.jsx(_e,{label:"Description",placeholder:"Enter range description",value:D.description,onChange:C=>w("description",C.target.value),errorMessage:T.description,isInvalid:!!T.description,isRequired:!0,rows:3,classNames:{input:"urbana-input"}}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground-700 mb-2 block",children:"Tags"}),e.jsx(Ct,{tags:D.tags,onTagsChange:C=>w("tags",C)})]})]})}),e.jsxs(ye,{children:[e.jsx(G,{variant:"light",onPress:v,children:"Cancel"}),e.jsxs(G,{color:"primary",onPress:h,children:[d?"Update":"Add"," Range"]})]})]})})})]})},Ss=({range:s,onEdit:a,onDelete:t})=>{const{getProductsForRange:r}=ne(),i=r(s.id).length;return e.jsxs(M,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.image?e.jsx(cs,{src:s.image,alt:s.name,width:40,height:40,className:"rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-secondary-100 rounded-lg flex items-center justify-center",children:e.jsx(l,{icon:"lucide:grid-3x3",width:20,className:"text-secondary-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:s.name}),e.jsxs(H,{size:"sm",variant:"flat",color:"secondary",children:[i," product",i!==1?"s":""]})]})]}),e.jsxs(Re,{children:[e.jsx(Fe,{children:e.jsx(G,{isIconOnly:!0,variant:"light",size:"sm",children:e.jsx(l,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(Oe,{"aria-label":"Range Actions",children:[e.jsx(ie,{startContent:e.jsx(l,{icon:"lucide:edit",width:16}),onPress:()=>a(s),children:"Edit"},"edit"),e.jsx(ie,{className:"text-danger",color:"danger",startContent:e.jsx(l,{icon:"lucide:trash",width:16}),onPress:()=>t(s.id),children:"Delete"},"delete")]})]})]})}),e.jsxs(U,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-foreground-600 mb-2",children:s.description}),s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.tags.map(n=>e.jsx(H,{size:"sm",variant:"flat",color:"default",children:n},n))})]})]})},St=({files:s,onFilesChange:a,productCode:t,category:r,range:i})=>{const[n,c]=W.useState(""),[o,g]=W.useState(""),m=F.useCallback(()=>{n.trim()&&o.trim()&&(a({...s,[n.trim()]:o.trim()}),c(""),g(""))},[n,o,s,a]),p=F.useCallback(d=>{const b={...s};delete b[d],a(b)},[s,a]),u=F.useCallback(()=>{var b;if(!((b=window.wp)!=null&&b.media)){console.error("WordPress media library not available");return}const d=window.wp.media({title:"Select Files",button:{text:"Add to Product"},multiple:!0});d.on("select",()=>{const D=d.state().get("selection").toJSON(),S={...s};D.forEach(O=>{const k=O.filename||O.title;S[k]=O.url}),a(S)}),d.open()},[s,a]);F.useCallback(async()=>{var b;if(!t||!r||!i){console.error("Missing product information for folder fetch");return}if(confirm("This will fetch files from the plugin folder and update the current file list. Continue?"))try{const D=await fetch("/wp-json/urbana/v1/fetch-product-files",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((b=window.urbanaAdmin)==null?void 0:b.nonce)||""},body:JSON.stringify({productCode:t.toLowerCase(),category:r.toLowerCase(),range:i.toLowerCase().replace(/\s+/g,"-")})});if(!D.ok)throw new Error(`Failed to fetch files: ${D.status}`);const S=await D.json();S.success&&S.files?a(S.files):console.warn("No files found in folder or fetch failed")}catch(D){console.error("Error fetching files from folder:",D)}},[t,r,i,a]);const x=d=>{var D;switch((D=d.split(".").pop())==null?void 0:D.toLowerCase()){case"pdf":return"lucide:file-text";case"dwg":case"dxf":return"lucide:compass";case"rvt":return"lucide:building";case"doc":case"docx":return"lucide:file-type";case"xls":case"xlsx":return"lucide:sheet";default:return"lucide:file"}};return e.jsxs(M,{children:[e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("h4",{className:"text-md font-semibold",children:"Product Files"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(G,{size:"sm",color:"primary",variant:"flat",onPress:u,startContent:e.jsx(l,{icon:"lucide:library",width:16}),children:"Media Library"})})]})}),e.jsxs(U,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{placeholder:"File name",value:n,onChange:d=>c(d.target.value),size:"sm",classNames:{input:"urbana-input"}}),e.jsx(ae,{placeholder:"File URL or path",value:o,onChange:d=>g(d.target.value),size:"sm",classNames:{input:"urbana-input"}}),e.jsx(G,{size:"sm",color:"primary",onPress:m,isDisabled:!n.trim()||!o.trim(),children:"Add"})]})}),Object.entries(s).length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-sm font-medium",children:["Files (",Object.entries(s).length,")"]})}),Object.entries(s).map(([d,b])=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-default-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{icon:x(b),width:20,className:"text-primary-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium text-sm",children:d}),e.jsx("p",{className:"text-xs text-foreground-500 truncate",children:b})]})]}),e.jsxs(Re,{children:[e.jsx(Fe,{children:e.jsx(G,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(l,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(Oe,{children:[e.jsx(ie,{startContent:e.jsx(l,{icon:"lucide:external-link",width:16}),onPress:()=>window.open(b,"_blank"),children:"View File"},"view"),e.jsx(ie,{className:"text-danger",color:"danger",startContent:e.jsx(l,{icon:"lucide:trash",width:16}),onPress:()=>p(d),children:"Remove"},"remove")]})]})]},d))]})]})]})]})},Dt=({imageGallery:s,onImageGalleryChange:a,productCode:t,category:r,range:i})=>{const n=F.useCallback((m,p)=>{const u=[...s];u[m]=p,a(u)},[s,a]),c=F.useCallback(m=>{const p=s.filter((u,x)=>x!==m);a(p)},[s,a]),o=F.useCallback(()=>{a([...s,""])},[s,a]),g=F.useCallback(()=>{var p;if(!((p=window.wp)!=null&&p.media)){console.error("WordPress media library not available");return}const m=window.wp.media({title:"Select Images",button:{text:"Add to Gallery"},multiple:!0,library:{type:"image"}});m.on("select",()=>{const x=m.state().get("selection").toJSON().map(d=>d.url);a([...s,...x])}),m.open()},[s,a]);return F.useCallback(async()=>{var p;if(!t||!r||!i){console.error("Missing product information for folder fetch");return}if(confirm("This will fetch images from the plugin folder and update the current gallery. Continue?"))try{const u=await fetch("/wp-json/urbana/v1/fetch-product-images",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((p=window.urbanaAdmin)==null?void 0:p.nonce)||""},body:JSON.stringify({productCode:t.toLowerCase(),category:r.toLowerCase(),range:i.toLowerCase().replace(/\s+/g,"-")})});if(!u.ok)throw new Error(`Failed to fetch images: ${u.status}`);const x=await u.json();x.success&&x.images?a(x.images):console.warn("No images found in folder or fetch failed")}catch(u){console.error("Error fetching images from folder:",u)}},[t,r,i,a]),e.jsxs(M,{children:[e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("h4",{className:"text-md font-semibold",children:"Image Gallery"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(G,{size:"sm",color:"primary",variant:"flat",onPress:g,startContent:e.jsx(l,{icon:"lucide:library",width:16}),children:"Media Library"})})]})}),e.jsxs(U,{className:"space-y-4",children:[s.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:s.map((m,p)=>e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden border-2 border-default-200",children:[m?e.jsx(cs,{src:m,alt:`Gallery image ${p+1}`,className:"w-full h-full object-cover",fallback:e.jsx("div",{className:"w-full h-full bg-default-100 flex items-center justify-center",children:e.jsx(l,{icon:"lucide:image",width:32,className:"text-default-400"})})}):e.jsx("div",{className:"w-full h-full bg-default-100 flex items-center justify-center",children:e.jsx(l,{icon:"lucide:image-plus",width:32,className:"text-default-400"})}),e.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsxs(Re,{children:[e.jsx(Fe,{children:e.jsx(G,{isIconOnly:!0,size:"sm",variant:"solid",color:"default",className:"bg-black/50 text-white",children:e.jsx(l,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(Oe,{children:[e.jsx(ie,{startContent:e.jsx(l,{icon:"lucide:edit",width:16}),onPress:()=>{const u=prompt("Enter image URL:",m);u!==null&&n(p,u)},children:"Edit URL"},"edit"),e.jsx(ie,{className:"text-danger",color:"danger",startContent:e.jsx(l,{icon:"lucide:trash",width:16}),onPress:()=>c(p),children:"Remove"},"remove")]})]})})]}),e.jsx(ae,{placeholder:"Image URL",value:m,onChange:u=>n(p,u.target.value),size:"sm",className:"mt-2",classNames:{input:"urbana-input"}})]},p))}),e.jsx(Ue,{}),e.jsx("div",{className:"flex justify-center",children:e.jsx(G,{variant:"dashed",onPress:o,startContent:e.jsx(l,{icon:"lucide:plus",width:16}),className:"w-full",children:"Add Image"})})]})]})},Rt=({specifications:s,onSpecificationsChange:a})=>{const[t,r]=W.useState(""),i=F.useCallback(()=>{t.trim()&&!s.includes(t.trim())&&(a([...s,t.trim()]),r(""))},[t,s,a]),n=F.useCallback(o=>{a(s.filter(g=>g!==o))},[s,a]),c=F.useCallback(o=>{o.key==="Enter"&&i()},[i]);return e.jsxs(M,{children:[e.jsx(Y,{className:"pb-3",children:e.jsx("h4",{className:"text-md font-semibold",children:"Product Specifications"})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ae,{placeholder:"Add specification (e.g., Dimensions: 3.0m x 3.0m)",value:t,onChange:o=>r(o.target.value),onKeyPress:c,size:"sm",classNames:{input:"urbana-input"},className:"flex-1"}),e.jsx(G,{size:"sm",color:"primary",onPress:i,isDisabled:!t.trim()||s.includes(t.trim()),startContent:e.jsx(l,{icon:"lucide:plus",width:16}),children:"Add"})]}),s.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("span",{className:"text-sm font-medium",children:["Specifications (",s.length,")"]})}),e.jsx("div",{className:"space-y-2",children:s.map((o,g)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-default-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-semibold text-primary-600",children:g+1})}),e.jsx("span",{className:"text-sm flex-1",children:o})]}),e.jsx(G,{size:"sm",variant:"light",color:"danger",onPress:()=>n(o),startContent:e.jsx(l,{icon:"lucide:x",width:14}),children:"Remove"})]},g))})]})]})]})};class re{static generateAssetStructure(a,t,r,i){const n=[];return r.forEach(c=>{var D,S;const o=(D=Object.entries(i.rangeToProducts).find(([O,k])=>k.includes(c.id)))==null?void 0:D[0];if(!o)return;const g=t.find(O=>O.id===o);if(!g)return;const m=(S=Object.entries(i.groupToRanges).find(([O,k])=>k.includes(o)))==null?void 0:S[0];if(!m)return;const p=a.find(O=>O.id===m);if(!p)return;const u=this.sanitizePathSegment(p.name),x=this.sanitizePathSegment(g.name),d=this.sanitizePathSegment(c.code),b={category:p.name.toLowerCase(),range:g.name.toLowerCase().replace(/\s+/g,"-"),productCode:c.code.toLowerCase(),paths:{imagesPath:`${this.baseAssetsPath}/${u}/${x}/${d}/images`,downloadsPath:`${this.baseAssetsPath}/${u}/${x}/${d}/downloads`,fullImagePath:`/wp-content/plugins/urbana/${this.baseAssetsPath}/${u}/${x}/${d}/images`,fullDownloadPath:`/wp-content/plugins/urbana/${this.baseAssetsPath}/${u}/${x}/${d}/downloads`}};n.push(b)}),n}static sanitizePathSegment(a){return a.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim()}static async generateFoldersAPI(a){var t;try{const r=await fetch("/wp-json/urbana/v1/generate-asset-folders",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((t=window.urbanaAdmin)==null?void 0:t.nonce)||""},body:JSON.stringify({structures:a.map(n=>({category:n.category,range:n.range,productCode:n.productCode,imagesPath:n.paths.imagesPath,downloadsPath:n.paths.downloadsPath}))})});if(!r.ok)throw new Error(`Failed to generate folders: ${r.status} ${r.statusText}`);return await r.json()}catch(r){throw console.error("Error generating folders:",r),r}}static async debugPaths(){var a;try{const t=await fetch("/wp-json/urbana/v1/debug-paths",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":((a=window.urbanaAdmin)==null?void 0:a.nonce)||""}});if(!t.ok)throw new Error(`Failed to get debug info: ${t.status} ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error getting debug info:",t),t}}static generateFolderPreview(a){const t=[];return a.forEach(r=>{t.push(r.paths.imagesPath),t.push(r.paths.downloadsPath)}),[...new Set(t)].sort()}static updateProductPaths(a,t){return a.map(r=>{const i=t.find(o=>o.productCode===r.code.toLowerCase());if(!i)return r;const n=r.imageGallery.length>0?r.imageGallery.map((o,g)=>!o||o.includes("shelter/")||o.includes("toilet/")||o.includes("bridge/")||o.includes("access/")?`${i.paths.imagesPath}/image-${g+1}.jpg`:o):[`${i.paths.imagesPath}/hero-image.jpg`],c={};return Object.entries(r.files).forEach(([o,g])=>{g.includes("/")?c[o]=g:c[o]=`${i.paths.downloadsPath}/${g}`}),{...r,imageGallery:n,files:c}})}static async fetchAndUpdateAllProductAssets(a,t,r,i,n,c){var g;if(this.generateAssetStructure(a,t,r,i).length===0)return{success:!1,updatedCount:0,message:"No products found with proper group/range relationships."};try{const m=await fetch("/wp-json/urbana/v1/fetch-all-product-assets",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((g=window.urbanaAdmin)==null?void 0:g.nonce)||""},body:JSON.stringify({stepperID:c||1})});if(!m.ok)throw new Error(`Failed to fetch assets: ${m.status}`);const p=await m.json();if(p.success){let u=0;return Object.entries(p.productAssets).forEach(([x,d])=>{const b=r.find(D=>D.code===x);b?(n(b.id,{imageGallery:d.images||[],files:d.files||{}}),u++):console.warn("Product not found for code:",x)}),{success:!0,updatedCount:u,message:`Successfully updated ${u} products with their assets.`}}else return{success:!1,updatedCount:0,message:"Failed to fetch assets: "+p.message}}catch(m){throw console.error("Error fetching all product assets:",m),m}}static async testDigitalOceanConnection(){var a;try{const t=await fetch("/wp-json/urbana/v1/digital-ocean/test-connection",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":((a=window.urbanaAdmin)==null?void 0:a.nonce)||""}});if(!t.ok)throw new Error(`Connection test failed: ${t.status} ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error testing Digital Ocean connection:",t),t}}static async fetchDigitalOceanAssets(a=""){var t;try{const r=await fetch("/wp-json/urbana/v1/digital-ocean/fetch-assets",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":((t=window.urbanaAdmin)==null?void 0:t.nonce)||""},body:JSON.stringify({prefix:a})});if(!r.ok)throw new Error(`Failed to fetch assets: ${r.status} ${r.statusText}`);return await r.json()}catch(r){throw console.error("Error fetching Digital Ocean assets:",r),r}}static async getDigitalOceanConfig(){var a;try{const t=await fetch("/wp-json/urbana/v1/digital-ocean/config",{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":((a=window.urbanaAdmin)==null?void 0:a.nonce)||""}});if(!t.ok)throw new Error(`Failed to get config: ${t.status} ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error getting Digital Ocean config:",t),t}}static updateProductPathsFromDigitalOcean(a,t,r,i,n){return a.map(c=>{var S,O;const o=(S=Object.entries(n.rangeToProducts).find(([k,T])=>T.includes(c.id)))==null?void 0:S[0];if(!o)return console.warn(`No range found for product: ${c.code}`),c;const g=i.find(k=>k.id===o);if(!g)return console.warn(`Range not found for rangeId: ${o}`),c;const m=(O=Object.entries(n.groupToRanges).find(([k,T])=>T.includes(o)))==null?void 0:O[0];if(!m)return console.warn(`No group found for range: ${g.name}`),c;const p=r.find(k=>k.id===m);if(!p)return console.warn(`Group not found for groupId: ${m}`),c;let u=null,x=null,d=null;for(const[k,T]of Object.entries(t)){if(typeof T=="object"&&!Array.isArray(T)&&(k.toLowerCase().includes(p.name.toLowerCase())||p.name.toLowerCase().includes(k.toLowerCase())))for(const[R,A]of Object.entries(T)){if(typeof A=="object"&&!Array.isArray(A)&&R.toLowerCase().replace(/[\s-_]/g,"")===g.name.toLowerCase().replace(/[\s-_]/g,"")){for(const[P,w]of Object.entries(A))if(P.toLowerCase()===c.code.toLowerCase()){u=w,x=k,d=R;break}}if(u)break}if(u)break}if(!u)return console.warn(`No Digital Ocean data found for product: ${c.code} (Group: ${p.name}, Range: ${g.name})`),c;console.log(`Found match for ${c.code}:`,{category:x,range:d,images:u.images.length,downloads:u.downloads.length});const b=u.images.map(k=>k.url),D={};return u.downloads.forEach(k=>{const T=this.generateFileDisplayNameFromFilename(k.filename);D[T]=k.url}),{...c,imageGallery:b.length>0?b:c.imageGallery,files:Object.keys(D).length>0?D:c.files}})}static generateFileDisplayNameFromFilename(a){var n;const t=a.replace(/\.[^/.]+$/,""),r=((n=a.split(".").pop())==null?void 0:n.toLowerCase())||"",i=t.replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").split(" ").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ");switch(r){case"pdf":return/spec/i.test(t)?"PDF Specification":/install/i.test(t)?"Installation Guide":/manual/i.test(t)?"User Manual":`${i} (PDF)`;case"dwg":return"CAD Drawing";case"rvt":return"Revit Model";case"doc":case"docx":return`${i} (Document)`;default:return i}}static buildCompleteStructureFromDigitalOcean(a){const t=[],r=[],i=[],n={groupToRanges:{},rangeToProducts:{}};return Object.entries(a).forEach(([c,o])=>{if(Array.isArray(o)||Object.keys(o).length===0)return;const g=this.sanitizePathSegment(c),m={id:g,name:c,icon:this.getDefaultIconForGroup(c),description:this.getDescriptionForGroup(c)};t.push(m),n.groupToRanges[g]=[],Object.entries(o).forEach(([p,u])=>{if(Array.isArray(u)||Object.keys(u).length===0)return;const x=this.sanitizePathSegment(p),d={id:x,name:p,image:"",description:this.getDescriptionForRange(p),tags:this.getTagsForRange(p)};r.push(d),n.groupToRanges[g].push(x),n.rangeToProducts[x]=[],Object.entries(u).forEach(([b,D])=>{const S=this.sanitizePathSegment(b),O=D.images.map(R=>R.url),k={};D.downloads.forEach(R=>{const A=this.generateFileDisplayNameFromFilename(R.filename);k[A]=R.url});const T={id:S,code:b,name:this.generateProductName(b),overview:`${p} ${b}`,description:`Product ${b} from ${p} range`,specifications:[],imageGallery:O,files:k};i.push(T),n.rangeToProducts[x].push(S)})})}),{productGroups:t,productRanges:r,products:i,relationships:n}}static getDefaultIconForGroup(a){const t=a.toLowerCase();return t.includes("shelter")?"lucide:home":t.includes("toilet")?"lucide:door-open":t.includes("access")?"lucide:key":t.includes("config")?"lucide:settings":"lucide:package"}static getDescriptionForGroup(a){return`${a} product category`}static getDescriptionForRange(a){return`${a} product range`}static getTagsForRange(a){return[a.toLowerCase()]}static generateProductName(a){return a.toUpperCase()}}hs(re,"baseAssetsPath","assets/products");const Ft=({stepperID:s})=>{const{products:a,productRanges:t,productGroups:r,addProduct:i,updateProduct:n,removeProduct:c,linkProductToRange:o,unlinkProductFromRange:g,relationships:m}=ne(),{isOpen:p,onOpen:u,onOpenChange:x,onClose:d}=ge(),[b,D]=W.useState(null),[S,O]=W.useState({code:"",name:"",overview:"",description:"",specifications:[],imageGallery:[],files:{}}),[k,T]=W.useState(new Set),[R,A]=W.useState({}),f=F.useMemo(()=>{var Z,B;if(!b)return null;const j=(Z=Object.entries(m.rangeToProducts).find(([L,$])=>$.includes(b.id)))==null?void 0:Z[0];if(!j)return null;const y=t.find(L=>L.id===j);if(!y)return null;const _=(B=Object.entries(m.groupToRanges).find(([L,$])=>$.includes(j)))==null?void 0:B[0];if(!_)return null;const q=r.find(L=>L.id===_);return q?{category:q.name,range:y.name,productCode:b.code}:null},[b,m,t,r]);F.useCallback(async()=>{if(confirm("This will fetch images and files from plugin folders for ALL products and update their data. This action cannot be undone. Continue?"))try{const y=await re.fetchAndUpdateAllProductAssets(r,t,a,m,n,s);J({color:y.success?"success":y.updatedCount===0?"warning":"danger",title:y.message})}catch(y){console.error("Error fetching all product assets:",y),J({color:"danger",title:"Error fetching assets. Please check console for details."})}},[n]);const P=F.useCallback(()=>{D(null),O({code:"",name:"",overview:"",description:"",specifications:[],imageGallery:[],files:{}}),T(new Set),A({}),u()},[u]),w=F.useCallback(j=>{D(j),O({code:j.code,name:j.name,overview:j.overview,description:j.description,specifications:[...j.specifications],imageGallery:[...j.imageGallery],files:{...j.files}});const y=new Set;Object.entries(m.rangeToProducts).forEach(([_,q])=>{q.includes(j.id)&&y.add(_)}),T(y),A({}),u()},[m.rangeToProducts,u]),I=F.useCallback(j=>{confirm("Are you sure you want to delete this product?")&&c(j)},[c]),h=F.useCallback((j,y)=>{if(O(_=>({..._,[j]:y})),j==="name"&&!S.code&&typeof y=="string"){const _=y.toUpperCase().replace(/\s+/g,"-").replace(/[^A-Z0-9-]/g,"");O(q=>({...q,code:_}))}R[j]&&A(_=>({..._,[j]:""}))},[S.code,R]),N=F.useCallback(()=>{const j={};return S.code.trim()||(j.code="Product code is required"),a.some(_=>_.code.toLowerCase()===S.code.toLowerCase()&&(!b||_.id!==b.id))&&(j.code="A product with this code already exists"),S.name.trim()||(j.name="Product name is required"),S.overview.trim()||(j.overview="Product overview is required"),S.description.trim()||(j.description="Product description is required"),k.size===0&&(j.ranges="Please select at least one product range"),A(j),Object.keys(j).length===0},[S,a,b,k]),E=F.useCallback(()=>{if(!N())return;let j;b?(n(b.id,S),j=b.id,Object.keys(m.rangeToProducts).forEach(y=>{g(y,b.id)})):(i(S),j=(S.code||S.name).toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")),k.forEach(y=>{o(y,j)}),d()},[N,b,n,S,m.rangeToProducts,g,i,k,o,d]),z=F.useCallback(()=>{const j={},y=[];return a.forEach(_=>{let q=!1;Object.entries(m.rangeToProducts).forEach(([Z,B])=>{if(B.includes(_.id)){const L=t.find($=>$.id===Z);L&&(j[L.name]||(j[L.name]=[]),j[L.name].push(_),q=!0)}}),q||y.push(_)}),{grouped:j,ungrouped:y}},[a,m.rangeToProducts,t]),{grouped:v,ungrouped:C}=z();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Products"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Manage individual products with detailed specifications"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(G,{color:"primary",onPress:P,startContent:e.jsx(l,{icon:"lucide:plus",width:18}),isDisabled:t.length===0,children:"Add Product"})})]}),t.length===0?e.jsx(M,{children:e.jsx(U,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(l,{icon:"lucide:alert-circle",width:48,className:"text-warning-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Product Ranges Available"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"You need to create product ranges first before adding products"})]})]})})}):a.length===0?e.jsx(M,{children:e.jsx(U,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(l,{icon:"lucide:package",width:48,className:"text-foreground-300"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Products Yet"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create your first product to get started"})]}),e.jsx(G,{color:"primary",onPress:P,startContent:e.jsx(l,{icon:"lucide:plus",width:18}),children:"Add Product"})]})})}):e.jsxs("div",{className:"space-y-6",children:[Object.entries(v).map(([j,y])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:grid-3x3",width:18}),j,e.jsxs(H,{size:"sm",variant:"flat",children:[y.length," product",y.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map(_=>e.jsx(ns,{product:_,onEdit:w,onDelete:I},_.id))})]},j)),C.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-semibold mb-3 flex items-center gap-2 text-warning-600",children:[e.jsx(l,{icon:"lucide:alert-triangle",width:18}),"Ungrouped Products",e.jsxs(H,{size:"sm",variant:"flat",color:"warning",children:[C.length," product",C.length!==1?"s":""]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(j=>e.jsx(ns,{product:j,onEdit:w,onDelete:I},j.id))})]})]}),e.jsx(ve,{isDismissable:!1,isKeyboardDismissDisabled:!0,isOpen:p,onOpenChange:x,size:"4xl",scrollBehavior:"inside",className:"urbana-modal",children:e.jsx(be,{children:j=>e.jsxs(e.Fragment,{children:[e.jsx(we,{children:b?"Edit Product":"Add Product"}),e.jsx(Ne,{children:e.jsxs(ke,{"aria-label":"Product Details",defaultSelectedKey:"basic",children:[e.jsx(V,{title:"Basic Info",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(ae,{label:"Product Code",placeholder:"e.g., SH-PEN-001",value:S.code,onChange:y=>h("code",y.target.value),errorMessage:R.code,isInvalid:!!R.code,isRequired:!0,classNames:{input:"urbana-input"}}),e.jsx(ae,{label:"Product Name",placeholder:"Enter product name",value:S.name,onChange:y=>h("name",y.target.value),errorMessage:R.name,isInvalid:!!R.name,isRequired:!0,classNames:{input:"urbana-input"}})]}),e.jsx(Ie,{label:"Product Ranges",placeholder:"Select product ranges",selectionMode:"multiple",selectedKeys:k,onSelectionChange:y=>T(y),errorMessage:R.ranges,isInvalid:!!R.ranges,isRequired:!0,children:t.map(y=>e.jsx(ze,{children:y.name},y.id))}),e.jsx(_e,{label:"Overview",placeholder:"Brief product overview",value:S.overview,onChange:y=>h("overview",y.target.value),errorMessage:R.overview,isInvalid:!!R.overview,isRequired:!0,rows:2,classNames:{input:"urbana-input"}}),e.jsx(_e,{label:"Description",placeholder:"Detailed product description",value:S.description,onChange:y=>h("description",y.target.value),errorMessage:R.description,isInvalid:!!R.description,isRequired:!0,rows:4,classNames:{input:"urbana-input"}})]})},"basic"),e.jsx(V,{title:"Specifications",children:e.jsx(Rt,{specifications:S.specifications,onSpecificationsChange:y=>h("specifications",y)})},"specifications"),e.jsx(V,{title:"Images",children:e.jsx(Dt,{imageGallery:S.imageGallery,onImageGalleryChange:y=>h("imageGallery",y),productCode:(f==null?void 0:f.productCode)||S.code,category:f==null?void 0:f.category,range:f==null?void 0:f.range})},"images"),e.jsx(V,{title:"Files",children:e.jsx(St,{files:S.files,onFilesChange:y=>h("files",y),productCode:(f==null?void 0:f.productCode)||S.code,category:f==null?void 0:f.category,range:f==null?void 0:f.range})},"files")]})}),e.jsxs(ye,{children:[e.jsx(G,{variant:"light",onPress:j,children:"Cancel"}),e.jsxs(G,{color:"primary",onPress:E,children:[b?"Update":"Add"," Product"]})]})]})})})]})},ns=W.memo(({product:s,onEdit:a,onDelete:t})=>{const r=s.imageGallery.length>0&&s.imageGallery[0];return e.jsxs(M,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(Y,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r?e.jsx(cs,{src:s.imageGallery[0],alt:s.name,width:40,height:40,className:"rounded-lg object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-success-100 rounded-lg flex items-center justify-center",children:e.jsx(l,{icon:"lucide:package",width:20,className:"text-success-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",children:s.name}),e.jsx(H,{size:"sm",variant:"flat",color:"success",children:s.code})]})]}),e.jsxs(Re,{children:[e.jsx(Fe,{children:e.jsx(G,{isIconOnly:!0,variant:"light",size:"sm",children:e.jsx(l,{icon:"lucide:more-vertical",width:16})})}),e.jsxs(Oe,{"aria-label":"Product Actions",children:[e.jsx(ie,{startContent:e.jsx(l,{icon:"lucide:edit",width:16}),onPress:()=>a(s),children:"Edit"},"edit"),e.jsx(ie,{className:"text-danger",color:"danger",startContent:e.jsx(l,{icon:"lucide:trash",width:16}),onPress:()=>t(s.id),children:"Delete"},"delete")]})]})]})}),e.jsxs(U,{className:"pt-0",children:[e.jsx("p",{className:"text-sm text-foreground-600 mb-2",children:s.overview}),s.specifications.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-semibold text-foreground-700",children:"Specifications:"}),e.jsxs("div",{className:"text-xs text-foreground-500",children:[s.specifications.slice(0,3).map((i,n)=>e.jsxs("div",{children:["• ",i]},n)),s.specifications.length>3&&e.jsxs("div",{children:["... and ",s.specifications.length-3," more"]})]})]})]})]})});ns.displayName="ProductCard";const Ot=()=>{const{productGroups:s,productRanges:a,products:t,relationships:r,linkRangeToGroup:i,unlinkRangeFromGroup:n,linkProductToRange:c,unlinkProductFromRange:o}=ne(),[g,m]=W.useState(null),[p,u]=W.useState(null),[x,d]=W.useState(!1),b=()=>s.map(h=>{const N=r.groupToRanges[h.id]||[],E=N.map(z=>{const v=a.find(y=>y.id===z),C=r.rangeToProducts[z]||[],j=C.map(y=>{const _=t.find(q=>q.id===y);return{id:y,name:(_==null?void 0:_.name)||"Unknown Product",code:_==null?void 0:_.code,overview:_==null?void 0:_.overview,type:"product",hasIssues:!_}}).filter(Boolean);return{id:z,name:(v==null?void 0:v.name)||"Unknown Range",description:v==null?void 0:v.description,type:"range",children:j,hasIssues:!v||C.length===0}}).filter(Boolean);return{id:h.id,name:h.name,description:h.description,type:"group",children:E,hasIssues:N.length===0}}),D=()=>{const h=a.filter(E=>!Object.values(r.groupToRanges).some(z=>z.includes(E.id))),N=t.filter(E=>!Object.values(r.rangeToProducts).some(z=>z.includes(E.id)));return{orphanedRanges:h,orphanedProducts:N}},S=()=>{const{orphanedRanges:h,orphanedProducts:N}=D(),E=Object.values(r.groupToRanges).reduce((v,C)=>v+C.length,0)+Object.values(r.rangeToProducts).reduce((v,C)=>v+C.length,0),z=Math.round((s.length-s.filter(v=>(r.groupToRanges[v.id]||[]).length===0).length+(a.length-h.length)+(t.length-N.length))/(s.length+a.length+t.length)*100);return{totalConnections:E,orphanedRanges:h.length,orphanedProducts:N.length,completionRate:isNaN(z)?0:z}},O=(h,N)=>{i(h,N)},k=(h,N)=>{n(h,N)},T=(h,N)=>{c(h,N)},R=(h,N)=>{o(h,N)},A=async()=>{d(!0),await new Promise(h=>setTimeout(h,1500)),d(!1)},f=b(),{orphanedRanges:P,orphanedProducts:w}=D(),I=S();return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Relationship Manager"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Manage connections between groups, ranges, and products"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(G,{color:"secondary",variant:"flat",onPress:A,startContent:e.jsx(l,{icon:"lucide:search",width:18}),isLoading:x,children:x?"Analyzing...":"Analyze Structure"})})]}),e.jsx(M,{className:"mb-6",children:e.jsx(U,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:I.totalConnections}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Total Connections"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-warning-600",children:I.orphanedRanges}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Orphaned Ranges"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-danger-600",children:I.orphanedProducts}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Orphaned Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-success-600",children:[I.completionRate,"%"]}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Structure Complete"}),e.jsx(ls,{value:I.completionRate,color:I.completionRate>80?"success":I.completionRate>50?"warning":"danger",size:"sm",className:"mt-1"})]})]})})}),e.jsxs(ke,{"aria-label":"Relationship Views",defaultSelectedKey:"tree",children:[e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:git-branch",width:16}),"Tree View"]}),children:e.jsxs("div",{className:"space-y-4",children:[f.length===0?e.jsx(M,{children:e.jsx(U,{className:"text-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(l,{icon:"lucide:git-branch",width:48,className:"text-foreground-300"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground-600",children:"No Structure Yet"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create groups, ranges, and products to see the relationship tree"})]})]})})}):e.jsx(Fs,{selectionMode:"multiple",variant:"bordered",children:f.map(h=>{var N;return e.jsx(Os,{title:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{icon:e.jsx(l,{icon:"lucide:folder",width:16}),className:"w-6 h-6 bg-primary-100 text-primary-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:h.name}),h.hasIssues&&e.jsx(l,{icon:"lucide:alert-triangle",width:16,className:"text-warning-500"})]}),e.jsx("div",{className:"text-xs text-foreground-500",children:h.description||"No description"})]}),e.jsx(fs,{classNames:{base:"absolute"},content:((N=h.children)==null?void 0:N.length)||0,color:"primary",size:"sm",children:e.jsx("div",{className:"w-4 h-4"})})]}),classNames:{indicator:"-rotate-90 data-[open=true]:rotate-90 rtl:-rotate-180"},children:h.children&&h.children.length>0?e.jsx("div",{className:"space-y-3 pl-4",children:h.children.map(E=>{var z;return e.jsxs("div",{className:"border-l-2 border-gray-200 pl-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(xe,{icon:e.jsx(l,{icon:"lucide:grid-3x3",width:16}),className:"w-6 h-6 bg-secondary-100 text-secondary-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:E.name}),E.hasIssues&&e.jsx(l,{icon:"lucide:alert-triangle",width:16,className:"text-warning-500"})]}),e.jsx("div",{className:"text-xs text-foreground-500",children:E.description||"No description"})]}),e.jsx(fs,{classNames:{base:"absolute"},content:((z=E.children)==null?void 0:z.length)||0,color:"secondary",size:"sm",children:e.jsx("div",{className:"w-4 h-4"})})]}),E.children&&E.children.length>0&&e.jsx("div",{className:"space-y-2 pl-8",children:E.children.map(v=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-gray-50 rounded-lg",children:[e.jsx(xe,{icon:e.jsx(l,{icon:"lucide:package",width:16}),className:"w-5 h-5 bg-success-100 text-success-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:v.name}),v.code&&e.jsx(H,{size:"sm",variant:"flat",color:"success",children:v.code}),v.hasIssues&&e.jsx(l,{icon:"lucide:alert-triangle",width:14,className:"text-warning-500"})]}),v.overview&&e.jsx("div",{className:"text-xs text-foreground-500",children:v.overview})]})]},v.id))})]},E.id)})}):e.jsxs("div",{className:"text-center py-6 text-foreground-400",children:[e.jsx(l,{icon:"lucide:inbox",width:32,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"No ranges linked to this group"})]})},h.id)})}),(P.length>0||w.length>0)&&e.jsxs(M,{className:"border-warning-200 bg-warning-50",children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center gap-2 text-warning-700",children:[e.jsx(l,{icon:"lucide:alert-triangle",width:20}),e.jsx("h4",{className:"font-semibold",children:"Orphaned Items"})]})}),e.jsxs(U,{className:"pt-0",children:[P.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Unlinked Ranges:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:P.map(h=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(l,{icon:"lucide:grid-3x3",width:16,className:"text-secondary-600"}),e.jsx("span",{className:"text-sm",children:h.name}),e.jsx("span",{className:"text-xs text-gray-500",children:h.description})]},h.id))})]}),w.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Unlinked Products:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:w.map(h=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-white rounded border",children:[e.jsx(l,{icon:"lucide:package",width:16,className:"text-success-600"}),e.jsx("span",{className:"text-sm",children:h.name}),e.jsx(H,{size:"sm",variant:"flat",color:"success",children:h.code})]},h.id))})]})]})]})]})},"tree"),e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:link",width:16}),"Manage Links"]}),children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(M,{children:[e.jsx(Y,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:arrow-right",width:16}),"Group → Range Links"]})}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ie,{label:"Select Group",placeholder:"Choose a product group",selectedKeys:g?new Set([g]):new Set,onSelectionChange:h=>m(Array.from(h)[0]||null),children:s.map(h=>e.jsx(ze,{children:h.name},h.id))}),g&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground-700",children:"Available Ranges:"}),a.map(h=>{const N=(r.groupToRanges[g]||[]).includes(h.id);return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{icon:"lucide:grid-3x3",width:16,className:"text-secondary-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:h.name}),e.jsx("div",{className:"text-xs text-foreground-500",children:h.description})]})]}),e.jsx(G,{size:"sm",color:N?"danger":"primary",variant:N?"flat":"solid",onPress:()=>{N?k(g,h.id):O(g,h.id)},children:N?"Unlink":"Link"})]},h.id)})]})]})})]}),e.jsxs(M,{children:[e.jsx(Y,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:arrow-right",width:16}),"Range → Product Links"]})}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ie,{label:"Select Range",placeholder:"Choose a product range",selectedKeys:p?new Set([p]):new Set,onSelectionChange:h=>u(Array.from(h)[0]||null),children:a.map(h=>e.jsx(ze,{children:h.name},h.id))}),p&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-foreground-700",children:"Available Products:"}),t.map(h=>{const N=(r.rangeToProducts[p]||[]).includes(h.id);return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{icon:"lucide:package",width:16,className:"text-success-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:h.name}),e.jsx("div",{className:"text-xs text-foreground-500",children:h.code})]})]}),e.jsx(G,{size:"sm",color:N?"danger":"primary",variant:N?"flat":"solid",onPress:()=>{N?R(p,h.id):T(p,h.id)},children:N?"Unlink":"Link"})]},h.id)})]})]})})]})]})},"manage"),e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:bar-chart-3",width:16}),"Analysis"]}),children:e.jsx("div",{className:"space-y-6",children:x?e.jsx(M,{children:e.jsxs(U,{className:"text-center py-12",children:[e.jsx(Rs,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-foreground-600",children:"Analyzing relationship structure..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsx(Y,{children:e.jsx("h4",{className:"font-semibold",children:"Structure Analysis"})}),e.jsx(U,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Groups"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Total Groups"}),e.jsx("span",{className:"text-sm font-medium",children:s.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"With Ranges"}),e.jsx("span",{className:"text-sm font-medium",children:s.filter(h=>(r.groupToRanges[h.id]||[]).length>0).length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Empty Groups"}),e.jsx("span",{className:"text-sm font-medium text-warning-600",children:s.filter(h=>(r.groupToRanges[h.id]||[]).length===0).length})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Ranges"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Total Ranges"}),e.jsx("span",{className:"text-sm font-medium",children:a.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Linked to Groups"}),e.jsx("span",{className:"text-sm font-medium",children:a.length-P.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"With Products"}),e.jsx("span",{className:"text-sm font-medium",children:a.filter(h=>(r.rangeToProducts[h.id]||[]).length>0).length})]})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-sm mb-2",children:"Products"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Total Products"}),e.jsx("span",{className:"text-sm font-medium",children:t.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Linked to Ranges"}),e.jsx("span",{className:"text-sm font-medium",children:t.length-w.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Orphaned"}),e.jsx("span",{className:"text-sm font-medium text-danger-600",children:w.length})]})]})]})]})})]}),e.jsxs(M,{children:[e.jsx(Y,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:lightbulb",width:16}),"Recommendations"]})}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-3",children:[I.orphanedProducts>0&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-danger-50 rounded-lg border border-danger-200",children:[e.jsx(l,{icon:"lucide:alert-triangle",width:16,className:"text-danger-600 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-danger-800",children:["You have ",I.orphanedProducts," unlinked product",I.orphanedProducts!==1?"s":""]}),e.jsx("p",{className:"text-xs text-danger-600",children:"Link these products to ranges so they appear in your product stepper."})]})]}),I.orphanedRanges>0&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-warning-50 rounded-lg border border-warning-200",children:[e.jsx(l,{icon:"lucide:alert-triangle",width:16,className:"text-warning-600 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-warning-800",children:["You have ",I.orphanedRanges," unlinked range",I.orphanedRanges!==1?"s":""]}),e.jsx("p",{className:"text-xs text-warning-600",children:"Link these ranges to product groups to organize your structure."})]})]}),s.filter(h=>(r.groupToRanges[h.id]||[]).length===0).length>0&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-primary-50 rounded-lg border border-primary-200",children:[e.jsx(l,{icon:"lucide:info",width:16,className:"text-primary-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-primary-800",children:"Some product groups are empty"}),e.jsx("p",{className:"text-xs text-primary-600",children:"Consider linking ranges to these groups or removing unused groups."})]})]}),I.completionRate>=90&&e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-success-50 rounded-lg border border-success-200",children:[e.jsx(l,{icon:"lucide:check-circle",width:16,className:"text-success-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-success-800",children:"Great job! Your structure is well organized"}),e.jsx("p",{className:"text-xs text-success-600",children:"Your data structure is ready for the product stepper."})]})]})]})})]})]})})},"analysis")]})]})},kt=()=>{const{productGroups:s,productRanges:a,products:t,relationships:r,exportData:i,importData:n}=ne(),{isOpen:c,onOpen:o,onOpenChange:g,onClose:m}=ge(),[p,u]=W.useState(""),[x,d]=W.useState(""),[b,D]=W.useState("structure"),S=()=>({stepperForm:{steps:s.map((I,h)=>{const N=r.groupToRanges[I.id]||[],E=N.map(v=>{const C=a.find(j=>j.id===v);return(C==null?void 0:C.name)||"Unknown Range"}),z={};return N.forEach(v=>{const C=a.find(j=>j.id===v);if(C){const j=r.rangeToProducts[v]||[];z[C.name]=j.map(y=>{const _=t.find(q=>q.id===y);return{id:(_==null?void 0:_.id)||y,code:(_==null?void 0:_.code)||"",name:(_==null?void 0:_.name)||"Unknown Product",overview:(_==null?void 0:_.overview)||"",description:(_==null?void 0:_.description)||"",specifications:(_==null?void 0:_.specifications)||[],imageGallery:(_==null?void 0:_.imageGallery)||[],files:(_==null?void 0:_.files)||{}}})}}),{step:h+1,title:I.name,categories:E.length>0?E:void 0,products:z}})}}),O=()=>{const w=i();d(JSON.stringify(w,null,2)),D("json")},k=()=>{try{const w=JSON.parse(p);n(w),u(""),m()}catch{alert("Invalid JSON format. Please check your data.")}},T=()=>{const w=S(),I=JSON.stringify(w,null,2),h="data:application/json;charset=utf-8,"+encodeURIComponent(I),N="stepper-config.json",E=document.createElement("a");E.setAttribute("href",h),E.setAttribute("download",N),E.click()},R=()=>{const w=S();navigator.clipboard.writeText(JSON.stringify(w,null,2))},A=S(),f={};A.stepperForm.steps.forEach(w=>{w.products&&Object.entries(w.products).forEach(([I,h])=>{f[I]||(f[I]=[]),f[I].push(...h)})});const P={totalSteps:A.stepperForm.steps.length,totalCategories:Object.keys(f).length,totalProducts:Object.values(f).reduce((w,I)=>w+I.length,0),hasIssues:A.stepperForm.steps.some(w=>!w.categories||w.categories.length===0)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Data Preview"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Preview and export your stepper configuration"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{variant:"flat",onPress:o,startContent:e.jsx(l,{icon:"lucide:upload",width:18}),children:"Import"}),e.jsx(G,{color:"secondary",onPress:O,startContent:e.jsx(l,{icon:"lucide:download",width:18}),children:"Export Data"}),e.jsx(G,{color:"primary",onPress:T,startContent:e.jsx(l,{icon:"lucide:file-down",width:18}),children:"Download Config"})]})]}),e.jsx(M,{className:"mb-6",children:e.jsx(U,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary-600",children:P.totalSteps}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Stepper Steps"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-secondary-600",children:P.totalCategories}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Categories"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-success-600",children:P.totalProducts}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Products"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`flex justify-center text-2xl font-bold ${P.hasIssues?"text-warning-600":"text-success-600"}`,children:P.hasIssues?e.jsx(l,{icon:"lucide:alert-triangle",width:32}):e.jsx(l,{icon:"lucide:check-circle",width:32})}),e.jsx("div",{className:"text-sm text-foreground-500",children:P.hasIssues?"Has Issues":"Ready"})]})]})})}),e.jsxs(ke,{"aria-label":"Preview Options",selectedKey:b,onSelectionChange:w=>D(w),children:[e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:layers",width:16}),"Structure Preview"]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(M,{children:[e.jsx(Y,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:list",width:16}),"Stepper Steps"]})}),e.jsx(U,{children:A.stepperForm.steps.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(l,{icon:"lucide:layers",width:48,className:"mx-auto text-foreground-300 mb-4"}),e.jsx("p",{className:"text-foreground-600",children:"No stepper steps configured"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Create product groups to generate stepper steps"})]}):e.jsx("div",{className:"space-y-4",children:A.stepperForm.steps.map(w=>e.jsxs("div",{className:"flex items-center gap-4 p-4 border rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-primary-600",children:w.step})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-semibold",children:w.title}),w.categories&&w.categories.length>0?e.jsx("div",{className:"flex gap-1 mt-1",children:w.categories.map((I,h)=>e.jsx(H,{size:"sm",variant:"flat",color:"secondary",children:I},h))}):e.jsxs("p",{className:"text-sm text-warning-600 mt-1",children:[e.jsx(l,{icon:"lucide:alert-triangle",width:14,className:"inline mr-1"}),"No categories linked"]})]})]},w.step))})})]}),e.jsxs(M,{children:[e.jsx(Y,{children:e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:package",width:16}),"Products by Category"]})}),e.jsx(U,{children:Object.keys(f).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(l,{icon:"lucide:package",width:48,className:"mx-auto text-foreground-300 mb-4"}),e.jsx("p",{className:"text-foreground-600",children:"No products configured"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Link products to ranges to see them here"})]}):e.jsx(Fs,{variant:"bordered",children:Object.entries(f).map(([w,I])=>e.jsx(Os,{title:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{icon:e.jsx(l,{icon:"lucide:grid-3x3",width:16}),className:"w-6 h-6 bg-secondary-100 text-secondary-600"}),e.jsx("span",{className:"font-medium",children:w}),e.jsxs(H,{size:"sm",variant:"flat",color:"secondary",children:[I.length," product",I.length!==1?"s":""]})]}),children:e.jsx("div",{className:"space-y-3 pl-4",children:I.map(h=>e.jsx("div",{className:"border-l-2 border-success-200 pl-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(xe,{icon:e.jsx(l,{icon:"lucide:package",width:16}),className:"w-8 h-8 bg-success-100 text-success-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h6",{className:"font-semibold",children:h.name}),e.jsx(H,{size:"sm",variant:"flat",color:"success",children:h.code})]}),e.jsx("p",{className:"text-sm text-foreground-600 mb-2",children:h.overview}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground-700",children:"Specifications:"}),e.jsx("span",{className:"text-foreground-500 ml-1",children:h.specifications.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground-700",children:"Images:"}),e.jsx("span",{className:"text-foreground-500 ml-1",children:h.imageGallery.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-foreground-700",children:"Files:"}),e.jsx("span",{className:"text-foreground-500 ml-1",children:Object.keys(h.files).length})]})]})]})]})},h.id))})},w))})})]})]})},"structure"),e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:code",width:16}),"JSON Preview"]}),children:e.jsxs(M,{children:[e.jsxs(Y,{className:"flex flex-row justify-between items-center",children:[e.jsx("h4",{className:"font-semibold",children:"Configuration JSON"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{size:"sm",variant:"flat",onPress:R,startContent:e.jsx(l,{icon:"lucide:copy",width:16}),children:"Copy"}),e.jsx(G,{size:"sm",color:"primary",onPress:T,startContent:e.jsx(l,{icon:"lucide:download",width:16}),children:"Download"})]})]}),e.jsx(U,{children:e.jsx("pre",{className:"w-full px-2 py-1 h-fit font-mono font-normal bg-default/40 text-default-700 rounded-small text-xs overflow-x-auto",children:e.jsx("code",{children:x||JSON.stringify(A,null,2)})})})]})},"json")]}),e.jsx(ve,{isOpen:c,onOpenChange:g,size:"2xl",children:e.jsx(be,{children:w=>e.jsxs(e.Fragment,{children:[e.jsx(we,{children:"Import Configuration"}),e.jsx(Ne,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-3 bg-warning-50 border border-warning-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:alert-triangle",width:16,className:"text-warning-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-warning-800",children:"Warning"}),e.jsx("p",{className:"text-xs text-warning-600",children:"Importing will replace all current data. Make sure to export your current configuration first if needed."})]})]})}),e.jsx(_e,{label:"JSON Data",placeholder:"Paste your exported JSON configuration here...",value:p,onChange:I=>u(I.target.value),rows:12,className:"font-mono text-sm"})]})}),e.jsxs(ye,{children:[e.jsx(G,{variant:"light",onPress:w,children:"Cancel"}),e.jsx(G,{color:"primary",onPress:k,isDisabled:!p.trim(),children:"Import"})]})]})})})]})},Tt=({isOpen:s,onOpenChange:a})=>{const{productGroups:t,productRanges:r,products:i,relationships:n,updateProduct:c}=ne(),[o,g]=F.useState([]),[m,p]=F.useState([]),[u,x]=F.useState(!1),[d,b]=F.useState(null),[D,S]=F.useState(!0),O=F.useMemo(()=>{const R=new Set(o.map(f=>f.category)),A=new Set(o.map(f=>f.range));return{products:o.length,folders:m.length,categories:R.size,ranges:A.size}},[o,m]);W.useEffect(()=>{if(s){const R=re.generateAssetStructure(t,r,i,n);g(R),p(re.generateFolderPreview(R)),b(null)}},[s,t,r,i,n]);const k=F.useCallback(async()=>{x(!0),b(null);try{const R=await re.generateFoldersAPI(o);b(R),D&&R.success?(re.updateProductPaths(i,o).forEach(f=>{c(f.id,{imageGallery:f.imageGallery,files:f.files})}),J({color:"success",title:"Folders created and product paths updated!"})):R.success?J({color:"success",title:R.message}):J({color:"danger",title:R.message})}catch(R){const A=R instanceof Error?R.message:"Unknown error occurred";b({success:!1,message:A,created:[]}),J({color:"danger",title:"Failed to generate folders",description:A})}finally{x(!1)}},[o,D,i,c]),T=F.useCallback(()=>{b(null),x(!1),a(!1)},[a]);return e.jsx(ve,{isOpen:s,onOpenChange:a,size:"3xl",scrollBehavior:"inside",className:"urbana-modal",isDismissable:!u,children:e.jsx(be,{children:R=>e.jsxs(e.Fragment,{children:[e.jsxs(we,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:folder-plus",width:20}),"Generate Asset Folders"]}),e.jsx("p",{className:"text-sm text-foreground-500 font-normal",children:"Create organized folder structure for product assets"})]}),e.jsx(Ne,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{className:"bg-gradient-to-r from-primary-50 to-secondary-50",children:e.jsx(U,{children:e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:O.products}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Products"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-secondary",children:O.folders}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Folders"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:O.categories}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Categories"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:O.ranges}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Ranges"})]})]})})}),e.jsx(M,{children:e.jsx(U,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:settings",width:16}),"Options"]}),e.jsx(Qe,{isSelected:D,onValueChange:S,isDisabled:u,size:"sm",children:e.jsxs("div",{className:"ml-2",children:[e.jsx("div",{className:"font-medium",children:"Update product paths automatically"}),e.jsx("div",{className:"text-xs text-foreground-500",children:"This will update existing products to use the new folder structure paths"})]})})]})})}),e.jsx(M,{children:e.jsx(U,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:eye",width:16}),"Folder Structure Preview"]}),e.jsxs(H,{size:"sm",variant:"flat",color:"primary",children:[m.length," folders"]})]}),e.jsx(pe,{className:"max-h-60",children:e.jsx("div",{className:"space-y-1 font-mono text-sm",children:m.map((A,f)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-md hover:bg-default-100",children:[e.jsx(l,{icon:A.includes("/images")?"lucide:image":"lucide:file",width:14,className:A.includes("/images")?"text-primary":"text-secondary"}),e.jsx("span",{className:"text-foreground-700 break-all",children:A})]},f))})})]})})}),u&&e.jsx(M,{className:"border-primary",children:e.jsx(U,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:loader",width:16,className:"animate-spin text-primary"}),e.jsx("span",{className:"font-semibold",children:"Generating Folders..."})]}),e.jsx(ls,{isIndeterminate:!0,color:"primary",size:"sm",className:"w-full"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Please wait while we create the folder structure..."})]})})}),d&&e.jsx(M,{className:d.success?"border-success":"border-danger",children:e.jsx(U,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:d.success?"lucide:check-circle":"lucide:x-circle",width:16,className:d.success?"text-success":"text-danger"}),e.jsx("span",{className:"font-semibold",children:d.success?"Success!":"Error"})]}),e.jsx("p",{className:"text-sm",children:d.message}),d.created.length>0&&e.jsxs("div",{children:[e.jsx(Ue,{className:"my-3"}),e.jsx("p",{className:"text-sm font-medium mb-2",children:"Created folders:"}),e.jsx(pe,{className:"max-h-32",children:e.jsx("div",{className:"space-y-1",children:d.created.map((A,f)=>e.jsxs("div",{className:"text-xs text-success-600 font-mono flex items-center gap-1",children:[e.jsx(l,{icon:"lucide:check",width:12}),A]},f))})})]})]})})}),!d&&e.jsx(M,{className:"bg-warning-50 border-warning",children:e.jsx(U,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-warning-600 flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:info",width:16}),"Instructions"]}),e.jsxs("ul",{className:"text-sm space-y-2 text-foreground-600",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"This will create physical folders in your plugin's assets directory"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Each product will get dedicated images/ and downloads/ folders"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Folder structure follows: category/range/product-code/"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"README files will be created to guide file placement"]})]})]})})})]})}),e.jsxs(ye,{children:[e.jsx(G,{variant:"light",onPress:T,isDisabled:u,children:d?"Close":"Cancel"}),!d&&e.jsx(G,{color:"primary",onPress:k,isLoading:u,isDisabled:u||o.length===0,startContent:u?void 0:e.jsx(l,{icon:"lucide:folder-plus",width:16}),children:u?"Generating...":"Generate Folders"})]})]})})})},Et=({isOpen:s,onOpenChange:a})=>{const{productGroups:t,productRanges:r,products:i,relationships:n,updateProduct:c,addProductGroup:o,addProductRange:g,addProduct:m,linkRangeToGroup:p,linkProductToRange:u,resetData:x}=ne(),[d,b]=F.useState(null),[D,S]=F.useState(!1),[O,k]=F.useState(!1),[T,R]=F.useState(!1),[A,f]=F.useState(null),[P,w]=F.useState(null),[I,h]=F.useState(!0),[N,E]=F.useState(""),[z,v]=F.useState("update"),C=F.useMemo(()=>{if(!P)return{categories:0,ranges:0,products:0,totalFiles:0,totalFolders:0};const{structured_data:B,total_folders:L,total_objects:$}=P,K=Object.keys(B).length;let X=0,ce=0,ee=0;return Object.values(B).forEach(le=>{X+=Object.keys(le).length,Object.values(le).forEach(Pe=>{ce+=Object.keys(Pe).length,Object.values(Pe).forEach(Je=>{ee+=Je.images.length+Je.downloads.length})})}),{categories:K,ranges:X,products:ce,totalFiles:ee,totalFolders:L||0}},[P]);F.useEffect(()=>{s&&(j(),w(null),f(null))},[s]);const j=F.useCallback(async()=>{S(!0);try{const B=await re.getDigitalOceanConfig();b(B)}catch(B){console.error("Failed to load config:",B),J({color:"danger",title:"Failed to load Digital Ocean configuration"})}finally{S(!1)}},[]),y=F.useCallback(async()=>{k(!0),f(null);try{const B=await re.testDigitalOceanConnection();f(B),J({color:B.success?"success":"danger",title:B.message})}catch(B){const L=B instanceof Error?B.message:"Unknown error occurred";f({success:!1,message:L}),J({color:"danger",title:"Connection test failed",description:L})}finally{k(!1)}},[]),_=F.useCallback(async()=>{R(!0),w(null);try{const B=await re.fetchDigitalOceanAssets(N);if(w(B),B.success)if(z==="replace"){const L=re.buildCompleteStructureFromDigitalOcean(B.structured_data);x(),L.productGroups.forEach($=>{o({name:$.name,icon:$.icon,description:$.description})}),L.productRanges.forEach($=>{g({name:$.name,image:$.image,description:$.description,tags:$.tags}),Object.entries(L.relationships.groupToRanges).forEach(([K,X])=>{X.includes($.id)&&p(K,$.id)})}),L.products.forEach($=>{m({code:$.code,name:$.name,overview:$.overview,description:$.description,specifications:$.specifications,imageGallery:$.imageGallery,files:$.files}),Object.entries(L.relationships.rangeToProducts).forEach(([K,X])=>{X.includes($.id)&&u(K,$.id)})}),J({color:"success",title:"Structure imported successfully!",description:`Created ${L.productGroups.length} groups, ${L.productRanges.length} ranges, and ${L.products.length} products.`})}else{const L=re.updateProductPathsFromDigitalOcean(i,B.structured_data,t,r,n);let $=0;L.forEach(K=>{const X=i.find(ce=>ce.code.toLowerCase()===K.code.toLowerCase());console.log(X,K),X&&(JSON.stringify(X.imageGallery)!==JSON.stringify(K.imageGallery)||JSON.stringify(X.files)!==JSON.stringify(K.files))&&(c(K.id,{imageGallery:K.imageGallery,files:K.files}),$++)}),J({color:"success",title:"Assets fetched successfully!",description:`Updated ${$} products with Digital Ocean assets.`})}}catch(B){const L=B instanceof Error?B.message:"Unknown error occurred";w({success:!1,message:L,total_folders:0,total_objects:0,raw_folders:[],raw_objects:[],structured_data:{},debug_info:{prefix:N||"",configuration:d||{bucket_name:"",region:"",endpoint:"",configured:!1},categories:[]}}),J({color:"danger",title:"Failed to fetch assets",description:L})}finally{R(!1)}},[N,z,i,t,r,n,c,o,g,m,p,u,x,d]),q=F.useCallback(()=>{w(null),f(null),R(!1),k(!1),a(!1)},[a]),Z=B=>Object.entries(B).map(([L,$])=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-semibold text-lg text-primary mb-2 flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:folder",width:16}),L]}),Object.entries($).map(([K,X])=>e.jsxs("div",{className:"ml-4 mb-3",children:[e.jsxs("h5",{className:"font-medium text-secondary mb-1 flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:folder-open",width:14}),K]}),Object.entries(X).map(([ce,ee])=>e.jsxs("div",{className:"ml-4 mb-2",children:[e.jsxs("h6",{className:"font-medium text-success mb-1 flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:package",width:12}),ce]}),e.jsxs("div",{className:"ml-4 text-sm space-y-1",children:[ee.images.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:image",width:12,className:"text-primary"}),e.jsxs("span",{children:["Images: ",ee.images.length]}),e.jsx(H,{size:"sm",variant:"flat",color:"primary",children:ee.images.length})]}),ee.downloads.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:file",width:12,className:"text-secondary"}),e.jsxs("span",{children:["Downloads: ",ee.downloads.length]}),e.jsx(H,{size:"sm",variant:"flat",color:"secondary",children:ee.downloads.length})]})]})]},ce))]},K))]},L));return e.jsx(ve,{isOpen:s,onOpenChange:a,size:"5xl",scrollBehavior:"inside",className:"urbana-modal",isDismissable:!T&&!O,children:e.jsx(be,{children:B=>e.jsxs(e.Fragment,{children:[e.jsxs(we,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:cloud-download",width:20}),"Fetch from Digital Ocean Spaces"]}),e.jsx("p",{className:"text-sm text-foreground-500 font-normal",children:"Fetch assets from Digital Ocean Spaces and update product paths automatically"})]}),e.jsx(Ne,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{className:d!=null&&d.configured?"border-success":"border-warning",children:e.jsxs(U,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{icon:d!=null&&d.configured?"lucide:check-circle":"lucide:alert-circle",width:20,className:d!=null&&d.configured?"text-success":"text-warning"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Configuration Status"}),e.jsx("p",{className:"text-sm text-foreground-500",children:d!=null&&d.configured?"Digital Ocean Spaces is configured":"Configuration required"})]})]}),e.jsx(G,{color:"primary",variant:"flat",size:"sm",onPress:y,isLoading:O,isDisabled:!(d!=null&&d.configured)||O||T,startContent:O?void 0:e.jsx(l,{icon:"lucide:wifi",width:16}),children:O?"Testing...":"Test Connection"})]}),d&&e.jsxs("div",{className:"mt-3 text-sm text-foreground-600",children:[e.jsxs("div",{children:["Bucket: ",d.bucket_name||"Not set"]}),e.jsxs("div",{children:["Region: ",d.region||"Not set"]}),e.jsxs("div",{children:["Endpoint: ",d.endpoint||"Not set"]})]}),A&&e.jsx("div",{className:"mt-3",children:e.jsx(H,{size:"sm",variant:"flat",color:A.success?"success":"danger",startContent:e.jsx(l,{icon:A.success?"lucide:check":"lucide:x",width:12}),children:A.message})})]})}),e.jsx(M,{children:e.jsx(U,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-semibold flex items-center gap-2 mb-2",children:[e.jsx(l,{icon:"lucide:settings",width:16}),"Fetch Options"]}),e.jsx(ae,{label:"Prefix Filter (Optional)",placeholder:"e.g., shelter/ or shelter/peninsula/",value:N,onValueChange:E,description:"Filter objects by prefix to limit the search scope",startContent:e.jsx(l,{icon:"lucide:filter",width:16}),isDisabled:T,classNames:{input:"urbana-input"}}),e.jsx(Ue,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-sm",children:"Import Mode"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(Qe,{isSelected:z==="update",onValueChange:L=>v(L?"update":"replace"),isDisabled:T,size:"sm",children:e.jsxs("div",{className:"ml-2",children:[e.jsx("div",{className:"font-medium",children:"Update existing products only"}),e.jsx("div",{className:"text-xs text-foreground-500",children:"Only update assets for products that already exist in your store"})]})}),e.jsx(Qe,{isSelected:z==="replace",onValueChange:L=>v(L?"replace":"update"),isDisabled:T,size:"sm",children:e.jsxs("div",{className:"ml-2",children:[e.jsx("div",{className:"font-medium",children:"Replace entire structure"}),e.jsx("div",{className:"text-xs text-foreground-500",children:"Clear existing data and import complete structure from Digital Ocean"})]})})]})]}),z==="replace"&&e.jsx("div",{className:"p-3 bg-warning-50 border border-warning-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:alert-triangle",width:16,className:"text-warning-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-warning-700",children:[e.jsx("strong",{children:"Warning:"})," This will clear all existing product groups, ranges, and products, then import the complete structure from Digital Ocean Spaces."]})]})})]})})}),T&&e.jsx(M,{className:"border-primary",children:e.jsx(U,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:loader",width:16,className:"animate-spin text-primary"}),e.jsx("span",{className:"font-semibold",children:"Fetching Assets..."})]}),e.jsx(ls,{isIndeterminate:!0,color:"primary",size:"sm",className:"w-full"}),e.jsx("p",{className:"text-sm text-foreground-500",children:"Please wait while we fetch assets from Digital Ocean Spaces..."})]})})}),P&&e.jsx(M,{className:P.success?"border-success":"border-danger",children:e.jsx(U,{children:e.jsxs(ke,{"aria-label":"Fetch Results",children:[e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:bar-chart",width:16}),"Summary"]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:P.success?"lucide:check-circle":"lucide:x-circle",width:16,className:P.success?"text-success":"text-danger"}),e.jsx("span",{className:"font-semibold",children:P.success?"Fetch Successful!":"Fetch Failed"})]}),e.jsx("p",{className:"text-sm",children:P.message}),P.success&&e.jsxs("div",{className:"grid grid-cols-5 gap-4 text-center mt-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:C.categories}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Categories"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-secondary",children:C.ranges}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Ranges"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-success",children:C.products}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Products"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:C.totalFiles}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Files"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-danger",children:C.totalFolders}),e.jsx("div",{className:"text-sm text-foreground-500",children:"Folders"})]})]})]})},"summary"),e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:folder-tree",width:16}),"Structure"]}),children:e.jsx(pe,{className:"max-h-96",children:e.jsx("div",{className:"text-sm",children:Object.keys(P.structured_data).length>0?Z(P.structured_data):e.jsxs("div",{className:"text-center text-foreground-500 py-8",children:[e.jsx(l,{icon:"lucide:folder-x",width:48,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No structured data found"})]})})})},"structure"),e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:bug",width:16}),"Debug"]}),children:e.jsx(pe,{className:"max-h-96",children:e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Configuration"}),e.jsx(Ve,{className:"text-xs",children:JSON.stringify(P.debug_info.configuration,null,2)})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Folders Found"}),e.jsx(pe,{className:"max-h-32",children:e.jsx(Ve,{className:"text-xs",children:P.raw_folders.length>0?P.raw_folders.join(`
`):"No folders found"})})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Fetch Summary"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Prefix: ",P.debug_info.prefix||"(none)"]}),e.jsxs("div",{children:["Total Folders: ",P.total_folders]}),e.jsxs("div",{children:["Total Objects: ",P.total_objects]}),e.jsxs("div",{children:["Categories Found: ",P.debug_info.categories.join(", ")||"(none)"]})]})]}),P.raw_objects.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium mb-2",children:"Sample Objects"}),e.jsx(pe,{className:"max-h-32",children:e.jsx(Ve,{className:"text-xs",children:JSON.stringify(P.raw_objects.slice(0,5),null,2)})})]})]})})},"debug")]})})}),!P&&(d==null?void 0:d.configured)&&e.jsx(M,{className:"bg-primary-50 border-primary",children:e.jsx(U,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-primary-600 flex items-center gap-2 mb-2",children:[e.jsx(l,{icon:"lucide:info",width:16}),"Instructions"]}),e.jsxs("ul",{className:"text-sm space-y-2 text-foreground-600",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Expected folder structure: category/range/product_code/type/filename"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Example: shelter/peninsula/k302/images/hero.jpg"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),'Type folders should be either "images" or "downloads"']}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(l,{icon:"lucide:check",width:14,className:"mt-0.5 text-success"}),"Use prefix filter to limit search scope for better performance"]})]})]})})})]})}),e.jsxs(ye,{children:[e.jsx(G,{variant:"light",onPress:q,isDisabled:T||O,children:P?"Close":"Cancel"}),!P&&e.jsx(G,{color:"primary",onPress:_,isLoading:T,isDisabled:!(d!=null&&d.configured)||T||O,startContent:T?void 0:e.jsx(l,{icon:"lucide:cloud-download",width:16}),children:T?"Fetching...":"Fetch Assets"})]})]})})})},At=()=>{const{productGroups:s,productRanges:a,products:t,relationships:r,exportData:i,importData:n,error:c,productData:o,loadData:g,saveData:m,isLoading:p,isSaving:u,isDirty:x,lastSaved:d,initializeFromWindowData:b,clearError:D}=ne(),[S,O]=F.useState(null),{isOpen:k,onOpenChange:T}=ge(),{isOpen:R,onOpen:A,onOpenChange:f}=ge();F.useEffect(()=>{const N=window.urbanaAdmin;N&&(b(),O(N.stepperId||1))},[b]);const P=async()=>{try{D();const N=await m();N&&O(N),J({color:"success",title:"Data saved successfully!"})}catch(N){console.error("Failed to save data:",N),J({color:"danger",title:"Failed to save data. Please try again."})}},w=async N=>{try{const E=new URL(window.location.href);E.searchParams.set("stepper_id",N.toString()),window.location.href=E.toString()}catch(E){console.error("Failed to load data builder:",E),J({color:"danger",title:"Failed to load data builder"})}},I=()=>{try{const N=i(),E="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(N,null,2)),z=document.createElement("a");z.setAttribute("href",E),z.setAttribute("download","product-configurator-data.json"),document.body.appendChild(z),z.click(),z.remove(),J({color:"success",title:"Data exported successfully!"})}catch(N){console.error("Export failed:",N),J({color:"danger",title:"Failed to export data"})}},h=N=>{var v;const E=(v=N.target.files)==null?void 0:v[0];if(!E)return;const z=new FileReader;z.onload=C=>{var j;try{const y=JSON.parse((j=C.target)==null?void 0:j.result);n(y),N.target.value="",J({color:"success",title:"Data imported successfully!"})}catch(y){console.error("Error parsing imported data:",y),J({color:"danger",title:"Invalid data format. Please check your JSON file."})}},z.readAsText(E)};return e.jsxs("div",{className:"urbana-builder-page max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-foreground",children:["Data Management",S&&e.jsxs("span",{className:"text-sm text-foreground-500 ml-2",children:["(Stepper ID: ",S,")"]})]}),e.jsx("p",{className:"text-sm text-foreground-500 mt-1",children:"Manage product groups, ranges, products, and their relationships"})]})}),e.jsxs("div",{className:"flex gap-2",children:[d&&e.jsxs("div",{className:"text-sm text-foreground-500 text-right ml-6",children:[e.jsx("div",{className:"text-xs",children:"Last saved:"}),e.jsx("div",{className:"font-medium",children:new Date(d).toLocaleString()})]}),e.jsx(G,{color:x?"primary":"success",variant:x?"solid":"flat",onPress:P,isLoading:u,isDisabled:u,startContent:u?"":e.jsx(l,{icon:"lucide:save",width:18}),children:u?"Saving...":x?"Save Changes":"Save Data"}),e.jsx(G,{color:"primary",variant:"flat",onPress:I,startContent:e.jsx(l,{icon:"lucide:download",width:18}),children:"Export Data"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(G,{color:"primary",variant:"flat",as:"span",startContent:e.jsx(l,{icon:"lucide:upload",width:18}),children:"Import Data"}),e.jsx("input",{type:"file",accept:".json",className:"hidden",onChange:h})]}),e.jsx(G,{color:"warning",variant:"flat",onPress:A,startContent:e.jsx(l,{icon:"lucide:cloud-download",width:18}),isDisabled:t.length===0,children:"Fetch from Digital Ocean"})]})]}),e.jsx(M,{className:"p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Switch to Stepper ID:"}),e.jsx("input",{type:"number",min:"1",className:"px-3 py-2 border rounded-md w-20",placeholder:"ID",onKeyDown:N=>{if(N.key==="Enter"){const E=parseInt(N.target.value);E>0&&w(E)}}}),e.jsx(G,{size:"sm",color:"primary",variant:"flat",onPress:()=>{const N=document.querySelector('input[type="number"]'),E=parseInt(N.value);E>0&&w(E)},children:"Switch"})]})}),e.jsx(M,{className:"p-0",children:e.jsxs(ke,{"aria-label":"Data Builder Tabs",fullWidth:!0,classNames:{tabList:"gap-0"},children:[e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:layers",width:18}),e.jsx("span",{children:"Product Groups"}),e.jsx("span",{className:"text-xs bg-primary-100 text-primary-800 px-2 py-0.5 rounded-full",children:s.length})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(Pt,{})})},"groups"),e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:grid-3x3",width:18}),e.jsx("span",{children:"Product Ranges"}),e.jsx("span",{className:"text-xs bg-secondary-100 text-secondary-800 px-2 py-0.5 rounded-full",children:a.length})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(_t,{})})},"ranges"),e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:package",width:18}),e.jsx("span",{children:"Products"}),e.jsx("span",{className:"text-xs bg-success-100 text-success-800 px-2 py-0.5 rounded-full",children:t.length})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(Ft,{stepperID:S})})},"products"),e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:link",width:18}),e.jsx("span",{children:"Relationships"})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(Ot,{})})},"relationships"),e.jsx(V,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{icon:"lucide:eye",width:18}),e.jsx("span",{children:"Data Preview"})]}),children:e.jsx("div",{className:"p-6",children:e.jsx(kt,{})})},"preview")]})}),e.jsx(Tt,{isOpen:k,onOpenChange:T}),e.jsx(Et,{isOpen:R,onOpenChange:f})]})};function Gt(){const{productGroups:s,isLoading:a,error:t,clearError:r,initializeFromWindowData:i,loadData:n}=ne();F.useEffect(()=>{window.urbanaAdmin&&s.length===0&&(console.log("App initializing from window data"),i())},[i,s.length]);const c=async()=>{try{r(),await n()}catch(o){console.error("Load failed:",o)}};return a?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(Rs,{size:"lg"}),e.jsx("p",{className:"text-foreground-600",children:"Loading product data..."})]})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"py-6 px-4 sm:px-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Product Data Builder"}),e.jsx("p",{className:"text-foreground-500 mt-2",children:"Create and manage product configuration data"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(G,{variant:"flat",color:"primary",startContent:e.jsx(l,{icon:"lucide:refresh-cw",width:18}),onPress:c,isLoading:a,children:"Refresh Data"})})]}),t&&e.jsx(at,{color:"danger",variant:"flat",className:"mb-6",title:"Error",description:t,endContent:e.jsx(G,{variant:"light",color:"danger",size:"sm",onPress:r,children:"Dismiss"})}),e.jsx(At,{})]})})}Zs.createRoot(document.getElementById("urbana-data-builder-root")).render(e.jsx(W.StrictMode,{children:e.jsxs(st,{children:[e.jsx(it,{}),e.jsx("main",{className:"text-foreground bg-background",children:e.jsx(Gt,{})})]})}));
